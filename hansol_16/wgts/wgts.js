var xa=apn.inheritWidget(apn.widgets["apn.wgt.rect"]);xa.styleMap={title:!0,visibility:!0,borderRadiusTopLeft:!0,borderRadiusTopRight:!0,borderRadiusBottomLeft:!0,borderRadiusBottomRight:!0,fillStyle:!0,alpha:!0,mediaID:!0},xa.exeItrNoResize=!0,xa.exeItrNoZoom=!0,xa.APX_NO_POINTER_EV=!0,xa.editor={},xa.editor.iconThumb="DB/EDU/imgs/wgts/common/icon_thumb.png",xa.scriptInfo={wgtData:{vertex:{help:{ko:"마지막 스트로크의 점들의 좌표입니다. Page에서의 Aspen 좌표계로 구성됩니다. 'StrokeEnd' Widget Event 또는 그 이후에 읽을 수 있습니다.",en:"Coordinates of vertexes of the last stroke, based on Page's Aspen coordinate system. Available on(or after) 'StrokeEnd' Widget Event.",ja:"最後のストロークの点の座標です。PageからのAspen座標系で構成されます。「StrokeEnd」Widget Eventまたはそれ以降に読み取ることができます。"},value:"[{x:Number,y:Number},...]",type:"go"},allStroke:{help:{ko:"현재 그려진 모든 스트로크의 좌표입니다. Page에서의 Aspen 좌표계로 구성됩니다. 'StrokeEnd' Widget Event 또는 그 이후에 읽을 수 있습니다.",en:"Coordinates of vertexes of all strokes, based on Page's Aspen coordinate system. Available on(or after) 'StrokeEnd' Widget Event.",ja:"現在描かれているすべてのストロークの座標です。PageからのAspen座標系で構成されます。「StrokeEnd」Widget Eventまたはそれ以降に読み取ることができます。"},value:"[[{x:Number,y:Number},...],...]",type:"go"},allVertex:{help:{ko:"현재 그려진 모든 스트로크와 점의 좌표입니다. Page에서의 Aspen 좌표계로 구성됩니다. 'StrokeEnd' Widget Event 또는 그 이후에 읽을 수 있습니다.",en:"Coordinates of vertexes of all strokes and points, based on Page's Aspen coordinate system. Available on(or after) 'StrokeEnd' Widget Event.",ja:"現在描かれているすべてのストロークと点の座標です。PageからのAspen座標系で構成されます。「StrokeEnd」Widget Eventまたはそれ以降に読み取ることができます。"},value:"[[{x:Number,y:Number},...],...]",type:"go"},allArea:{help:{ko:"등록된 모든 영역의 좌표입니다. Page에서의 Aspen 좌표계로 구성됩니다.",en:"Coordinates of vertexes of all registered areas, based on Page's Aspen coordinate system.",ja:"登録されたすべての領域の座標です。PageからのAspen座標系で構成されます。"},value:"[[{x:Number,y:Number},...]|undefined,...]",type:"go"},polygon:{help:{ko:"Boolean|undefined\n스트로크를 닫아 다각형으로 만듭니다.",en:"Boolean|undefined\nClose a stroke to be a polygon",ja:"Boolean|undefined\nストロークを閉じ、多角形にします。"},value:!1},strokeStyle:{help:{ko:"Color\n스트로크의 색상입니다.",en:"Color\nColor of stroke",ja:"Color\nストロークの色です。"},value:"#000000"},lineWeight:{help:{ko:"Number\n스트로크의 굵기입니다. 단위는 Pixel입니다.",en:"Number\nWeight of stroke in pixel",ja:"Number\nストロークの太さです。単位はPixelです。"},value:1},inDrawing:{help:{ko:"Boolean\n스트로크를 그리는 중인지 확인합니다.",en:"Booleanr\nCheck if stroke is being drawn",ja:"Boolean\nストロークを描いているかを確認します。"},value:!1,type:"go"}},wgtRun:{draw:{param:"{stroke:[{x:Number,y:Number},...], strokeStyle:Color|undefined, lineWeight:Number|undefined, area:0-basedNumber|undefined}",help:{ko:"스트로크를 그립니다. 좌표는 Page에서의 Aspen 좌표계로 구성됩니다.",en:"Draw the given stroke. Based on Page's Aspen coordinate system.",ja:"ストロークを描きます。座標はPageからのAspen座標系で構成されます。"}}}},xa.DEP_LN=[1,3,5,7,11,15,20,26,33],xa.DEP_SP=[15,19,25,31,39],xa.DEP_ER=[7,9,13,17,23,33],xa.DEP_HL=[13,15,17,19,21,23,27,33,41],xa.CLR_RB=["#FF0000","#FF7F00","#FFFF00","#00FF00","#3783FF","#4815AA","#9400D3"],xa.CLR_RBmap={3:[0,2,6],4:[0,2,3,6],5:[0,2,3,4,6],6:[0,1,2,3,4,6],7:[0,1,2,3,4,5,6]},xa.properties=xa.properties||{},xa.properties.state="pen",xa.properties.attrs={apxDrawControl:!0,cfg:{pen:[{name:"Black",clr:"#000000"}],penIndex:1,size:{pen:xa.DEP_LN[1],spray:xa.DEP_SP[1],eraser:xa.DEP_ER[2],hlpen:xa.DEP_HL[3]},area:[{id:""}],areaC:""}},xa.exeCreateTag=function(e,t,a,r,o,n){var i=apn.widgets["apn.wgt.rect"].exeCreateTag.call(this,e,t,a,r,o,n);return i.tagOnPostSetFillStyle=function(e,t){e.style.backgroundColor="transparent"},i},xa.exeOnLoad=function(e,t){function a(t,a){if(!o.ctx._transMode)if(10==o.ctx.state){var l=s.lineWidth,c=s.strokeStyle,p=o.ctx._penStyle;if("rainbow"==p&&l>=5){for(var g=Math.min(Math.ceil(l/2),6),u=new Array(g),h=l/(2*(g-1)+1),v=0;v<u.length;v++)s.strokeStyle=n.CLR_RB[n.CLR_RBmap[g][v]],s.lineWidth=h*(2*(u.length-1-v)+1),s.lineTo(t,a),s.stroke();s.strokeStyle=c,s.lineWidth=l}else if(p&&p.indexOf&&0==p.indexOf("neon")&&l>=3){var h=Math.ceil(.07*l);s.strokeStyle=p.substring(4),s.lineTo(t,a),s.stroke(),s.strokeStyle=c,s.lineWidth=l-2*h,s.lineTo(t,a),s.stroke(),s.lineWidth=l}else s.lineTo(t,a),s.stroke()}else 12==o.ctx.state?(i.clearRect(0,0,i.canvas.width,i.canvas.height),i.beginPath(),i.moveTo(d,x),i.lineTo(t,x),i.stroke()):11==o.ctx.state&&eduWgtSketchPad._sprayPen(o,s,t,a,Math.ceil(1/e.getZoomX()*r.size.spray/2))}var r=e.wgtGetProperty(t,"cfg");this._buildAreaInfo(e.screen,t,r);var o=e.wgtTag(t),n=this;o.canvas=o.$TAG("canvas",{style:"position:absolute;"}),o.canvas.width=parseInt(o.style.width),o.canvas.height=parseInt(o.style.height),o.canvas.style.width=o.style.width,o.canvas.style.height=o.style.height,o.canvas.style.left="0px",o.canvas.style.top="0px",e.viewer.ISub_pauseDrag&&"apn.auto"==e.wgtGetProperty(t,"apxCursor",!0)&&apn.IWidget.exeSetCursor(o,"auto"),o.ctx={},o.ctx.curStrokeStyle=r.pen[0].clr,o.ctx.state=0,o.ctx._lastStroke=[],o.ctx._allStroke=[],e.wgtSetProperty(t,"polygon",!1),this._applyTool(e,t,"pen");var i,s=o.canvas.getContext("2d");if(s.lineJoin="round",s.lineCap="round",s.clearRect(0,0,s.canvas.width,s.canvas.height),s.fillStyle=e.wgtGetProperty(t,"apxFillStyle",!0),s.fillRect(0,0,s.canvas.width,s.canvas.height),r.area){o.ctx._uAreaPos={};for(var l,c=0;c<r.area.length;c++)l=r.area[c].id,l&&e.wgtTag(l)&&e.wgtGetProperty(l,"vertex")&&(o.ctx._uAreaPos[l]={x:e.screen.objects[l].init.position.x,y:e.screen.objects[l].init.position.y})}var p,d,x,g,u;e.tagPassPointerEvent(o.canvas,!0),e.tagDraggable(o,!0,!0),o.apxOnDrag=function(e,r,n,i,s,l,c,d,x,g){if(p){if(void 0!==x&&(c=x,d=g),e.viewer.ISub_pauseDrag){var h=e.viewer.getPM().tag,v=parseInt(h.style.left),f=parseInt(h.style.top),y=bx.HCL.getElementX2(o)-bx.HCL.getElementX(h),S=bx.HCL.getElementY2(o)-bx.HCL.getElementY(h);i=e.viewer.onGestureCoordTransformX(l.clientX-v,l.clientY-f),s=e.viewer.onGestureCoordTransformY(l.clientX-v,l.clientY-f),c=i-y,d=s-S}10==o.ctx.state||11==o.ctx.state?o.ctx._lastStroke.push({x:c*e.getZoomX(),y:d*e.getZoomY()}):(o.ctx._lastStroke[1]=o.ctx._lastStroke[1]||{y:o.ctx._lastStroke[0].y},o.ctx._lastStroke[1].x=c*e.getZoomX()),a(c,d),e.wgtGetProperty(t,"strokeEvent")&&e.fireEvent("wgtEvent","stroke",t,void 0,!0),u=!0}return!1},o.apxOnDragStart=function(e,a,l,c,h,v,f,y){if(e.viewer.ISub_pauseDrag&&"apn.COverlayPage"==e.screen.module&&e.viewer.ISub_pauseDrag(!0,!0),void 0!==f&&(h=f,v=y),e.viewer.ISub_pauseDrag){var S=e.viewer.getPM().tag,k=parseInt(S.style.left),_=parseInt(S.style.top),b=bx.HCL.getElementX2(o)-bx.HCL.getElementX(S),C=bx.HCL.getElementY2(o)-bx.HCL.getElementY(S);a=e.viewer.onGestureCoordTransformX(c.clientX-k,c.clientY-_),l=e.viewer.onGestureCoordTransformY(c.clientX-k,c.clientY-_),h=a-b,v=l-C}return g=n._detectArea(o,h*e.getZoomX(),v*e.getZoomY()),"Y"==r.areaC&&void 0===g||(o.ctx.state>=10&&o.ctx.state<20&&("Y"==r.areaC?o.ctx._lastHitArea=g:o.ctx._lastHitArea=void 0,e.fireEvent("wgtEvent","strokePreStart",t,void 0,!0),p=!0,u=!1,o.ctx.inDrag=p,o.ctx._lastStroke.length=0,o.ctx._lastStroke.push({x:h*e.getZoomX(),y:v*e.getZoomY()}),void 0!==g&&e.fireEvent("wgtEvent","sS_"+g,t,void 0,!0),e.fireEvent("wgtEvent","strokeStart",t,void 0,!0),"Y"==r.areaC&&void 0!==g&&n._maskArea(e,o,g),o.ctx._transMode||(10==o.ctx.state?(o.ctx._penStyle&&o.ctx._penStyle.image&&o.ctx._penStyle.image.width&&o.ctx._penStyle.image.height&&(s.strokeStyle=s.createPattern(o.ctx._penStyle.image,"repeat")),s.beginPath(),s.moveTo(h,v)):12==o.ctx.state?(i=o.ctx.uOffCvs.getContext("2d"),i.lineCap="butt",i.lineWidth=s.lineWidth,i.strokeStyle=o.ctx.curStrokeStyle,i.globalCompositeOperation="source-over",i.clearRect(0,0,i.canvas.width,i.canvas.height),i.canvas.style.display="block",d=h,x=v):11==o.ctx.state&&eduWgtSketchPad._sprayPen(o,s,h,v,Math.ceil(1/e.getZoomX()*r.size.spray/2))),o.ctx._firstX=h,o.ctx._firstY=v),!0)},o.apxOnDragEnd=function(e){return e.viewer.ISub_pauseDrag&&"apn.COverlayPage"==e.screen.module&&e.viewer.ISub_pauseDrag(!1,!1),p&&o.ctx.state>=10&&o.ctx.state<20&&(u||o.ctx._lastStroke[0]&&a(o.ctx._lastStroke[0].x/e.getZoomX(),o.ctx._lastStroke[0].y/e.getZoomY()),o.ctx._transMode||(12==o.ctx.state?(s.drawImage(i.canvas,0,0),i.canvas.style.display="none"):e.wgtGetProperty(t,"polygon")&&void 0!==o.ctx._firstX&&(s.lineTo(o.ctx._firstX,o.ctx._firstY),s.stroke())),o.ctx._lastStroke.length>1?o.ctx._allStroke.push(o.ctx._lastStroke.concat()):1==o.ctx._lastStroke.length&&o.ctx._allStroke.push([{x:o.ctx._lastStroke[0].x,y:o.ctx._lastStroke[0].y},{x:o.ctx._lastStroke[0].x,y:o.ctx._lastStroke[0].y}]),p=!1,u=!1,o.ctx.inDrag=p,"Y"==r.areaC&&void 0!==g&&(s.restore(),o.ctx.masked&&(s.save(),n._maskAllArea(e,o))),void 0!==g&&e.fireEvent("wgtEvent","sE_"+g,t),e.fireEvent("wgtEvent","strokeEnd",t)),g=void 0,!0}},xa.exeOnStart=function(e,t){var a=e.wgtTag(t);e.fireApxMediaEvent(t,"load",a.canvas);var r=e.wgtGetProperty(t,"cfg");if(r.area){for(var o=0;o<r.area.length;o++)r.area[o].id&&e.wgtGetProperty(r.area[o].id,"apxVisibility",!0)===!0&&e.runITR({action:"CWP",set:{visibility:"Pass"},target:{objectID:r.area[o].id}});a.ctx._uArea=[];for(var n,i,s,l,c=e.screen.objects[t].init,o=0;o<r.area.length;o++){if(n=void 0,l=r.area[o].id,l&&e.wgtTag(l)&&(n=e.wgtGetProperty(l,"vertex"),n&&n.length<3&&(n=void 0)),n)for(i=0;i<n.length;i++)n[i].x=n[i].x+a.ctx._uAreaPos[l].x-c.position.x,n[i].y=n[i].y+a.ctx._uAreaPos[l].y-c.position.y,s=!0;a.ctx._uArea.push(n)}if(s&&"Y"==r.areaC){var p=a.canvas.getContext("2d");p.save(),this._maskAllArea(e,a)}}},xa.exeSetState=function(e,t,a,r){var o=e.wgtId(t),n=e.wgtGetProperty(o,"cfg"),i=a.split(":");if("pen"==i[0]||"spray"==i[0]||"eraser"==i[0]||"hlpen"==i[0])r&&(t.ctx._penStyle=null),this._applyTool(e,o,i[0]);else if("color"==i[0]){for(var s=0;s<n.pen.length;s++)if(n.pen[s].apxIndex==parseInt(i[1])){t.ctx._penStyle=null,t.ctx.curStrokeStyle=n.pen[s].clr,this._applyTool(e,o);break}}else"sPen"==i[0]?(n.size.pen=parseInt(i[1]),this._applyTool(e,o)):"sSpray"==i[0]?(n.size.spray=parseInt(i[1]),this._applyTool(e,o)):"sEraser"==i[0]?(n.size.eraser=parseInt(i[1]),this._applyTool(e,o)):"sHlPen"==i[0]?(n.size.hlpen=parseInt(i[1]),this._applyTool(e,o)):"clear"==i[0]?t.ctx&&t.ctx.inDrag?e.log(o,"Cannot reset this widget during drawing stroke."):this._reset(e,t):"save"==i[0]?this._stackSave&&this._stackSave(e,t):"restore"==i[0]?this._stackRestore&&this._stackRestore(e,t):"Y"==n.areaC&&0==i[0].indexOf("clear_")&&(t.ctx&&t.ctx.inDrag?e.log(o,"Cannot reset this widget during drawing stroke."):this._resetArea(e,t,parseInt(i[0].substring(6))))},xa.exePropSet=function(e,t,a,r,o){function n(a,r){for(var o=0;o<r.length;o++)void 0!==r[o].x&&void 0!==r[o].y||e.log(t,"Widget:run('draw') with invalid stroke point. "+JSON.stringify(r[o])),0==o&&a.moveTo((r[o].x-l.position.x)/e.getZoomX(),(r[o].y-l.position.y)/e.getZoomY()),(o>0||1==r.length)&&a.lineTo((r[o].x-l.position.x)/e.getZoomX(),(r[o].y-l.position.y)/e.getZoomY());a.stroke()}if("transparent"==a){if(o)return!0;var i=e.wgtTag(t);i.ctx&&(i.ctx._transMode=r)}else if("strokeStyle"==a){if(o)return!0;if(r){var i=e.wgtTag(t);i.ctx&&(i.ctx._penStyle=null,i.ctx.curStrokeStyle=r,this._applyTool(e,t))}}else if("penStyle"==a){if(o)return!0;if(r){var i=e.wgtTag(t);i.ctx&&(i.ctx._penStyle=r)}}else if("lineWeight"==a){if(o)return!0;var i=e.wgtTag(t),s=e.wgtGetProperty(t,"cfg");r=bx.$checkNaN(parseInt(r)),s.size.pen=r,s.size.spray=r,s.size.eraser=r,s.size.hlpen=r,this._applyTool(e,t)}else if("draw"==a){if(o)return!0;if(r&&r.stroke&&r.stroke.length){var i=e.wgtTag(t),l=e.screen.objects[t].init,c=i.canvas.getContext("2d"),p=c.strokeStyle,d=c.lineWidth,x=c.globalCompositeOperation,g=r.strokeStyle;if(void 0!==r.area&&this._maskArea(e,i,r.area),"eraser"==g?c.globalCompositeOperation="destination-out":g&&("rainbow"==g||(g.code?g.image&&g.image.width&&g.image.height&&(c.strokeStyle=c.createPattern(g.image,"repeat")):c.strokeStyle=g)),void 0!==r.lineWeight&&(c.lineWidth=Math.ceil(bx.$checkNaN(parseInt(r.lineWeight))/e.getZoomX())),c.beginPath(),"rainbow"==g)for(var u=Math.max(5,c.lineWidth),h=Math.min(Math.ceil(u/2),6),v=new Array(h),f=u/(2*(h-1)+1),y=0;y<v.length;y++)c.strokeStyle=this.CLR_RB[this.CLR_RBmap[h][y]],c.lineWidth=f*(2*(v.length-1-y)+1),n(c,r.stroke);else if(g&&g.indexOf&&0==g.indexOf("neon")){var u=Math.max(3,c.lineWidth),f=Math.ceil(.07*u),S=g.split("_")[1];c.strokeStyle=g.split("_")[0].substring(4),n(c,r.stroke),c.strokeStyle=S||p,c.lineWidth=u-2*f,n(c,r.stroke)}else n(c,r.stroke);"eraser"==g?c.globalCompositeOperation=x:c.strokeStyle=p,c.lineWidth=d}else e.log(t,"Widget:run('draw') with invalid parameter. "+JSON.stringify(r))}},xa.exePropGet=function(e,t,a,r){function o(a){var r=[];if(a&&a.length)for(var o=e.screen.objects[t].init,n=0;n<a.length;n++)r.push({x:Math.round(o.position.x+a[n].x),y:Math.round(o.position.y+a[n].y)});return r}if("lastStroke"==a){if(r)return!0;var n=e.wgtTag(t);return n.ctx&&n.ctx._lastStroke&&n.ctx._lastStroke.length?n.ctx._lastStroke.concat():[]}if("vertex"==a||"vertexInPage"==a){if(r)return!0;var n=e.wgtTag(t);return n.ctx&&n.ctx._lastStroke&&n.ctx._lastStroke.length?o(n.ctx._lastStroke):[]}if("allStroke"==a||"allVertex"==a){if(r)return!0;var n=e.wgtTag(t),i=[];if(n.ctx&&n.ctx._allStroke&&n.ctx._allStroke.length)for(var s=0;s<n.ctx._allStroke.length;s++){if("allVertex"==a);else if(2==n.ctx._allStroke[s].length&&n.ctx._allStroke[s][0].x==n.ctx._allStroke[s][1].x&&n.ctx._allStroke[s][0].y==n.ctx._allStroke[s][1].y)continue;i.push(o(n.ctx._allStroke[s]))}return i}if("allArea"==a){if(r)return!0;var n=e.wgtTag(t),i=[];if(n.ctx&&n.ctx._uArea&&n.ctx._uArea.length)for(var s=0;s<n.ctx._uArea.length;s++)n.ctx._uArea[s]&&n.ctx._uArea[s].length?i.push(o(n.ctx._uArea[s])):i.push(void 0);return i}if("strokeStyle"==a){if(r)return!0;var n=e.wgtTag(t);if(n.ctx){var l=n.ctx._penStyle;return l?l.code?l.code:l.indexOf&&0==l.indexOf("neon")?l+(n.ctx.curStrokeStyle?"_"+n.ctx.curStrokeStyle:""):l:n.ctx.curStrokeStyle||"#000000"}}else{if("lineWeight"==a){if(r)return!0;var n=e.wgtTag(t),c=e.wgtGetProperty(t,"cfg");return n.ctx&&n.ctx.curTool?parseInt(c.size[n.ctx.curTool]):1}if("inDrawing"==a){if(r)return!0;var n=e.wgtTag(t);return!(!n.ctx||!n.ctx.inDrag)}if("area"==a){if(r)return!0;var n=e.wgtTag(t);if(n.ctx)return n.ctx._lastHitArea}}},xa.exeDetect=function(e,t,a,r,o,n){return"Y"!=a.create.data.properties.attrs.cfg.areaC||void 0!==this._detectArea(t,o,n)},xa._detectArea=function(e,t,a){if(e.ctx._uArea)for(var r=0;r<e.ctx._uArea.length;r++)if(e.ctx._uArea[r]&&bx.CCanvasWnd.intersect_point_polygon(t,a,e.ctx._uArea[r]))return r},xa._reset=function(e,t){var a=t.canvas.getContext("2d"),r=a.fillStyle;t.ctx.masked&&a.restore(),a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle=e.wgtGetProperty(t.apnOID,"apxFillStyle",!0),a.fillRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle=r,t.ctx&&t.ctx.img&&(a.globalCompositeOperation="source-over",a.drawImage(t.ctx.img,0,0,a.canvas.width,a.canvas.height),this._applyTool(e,e.wgtId(t),"eraser")),t.ctx._allStroke=[],t.ctx._lastStroke=[],t.ctx.masked&&(a.save(),this._maskAllArea(e,t))},xa._resetArea=function(e,t,a){var r;if(t.ctx._uArea&&(r=t.ctx._uArea[a])){var o=t.canvas.getContext("2d"),n=1/e.getZoomX(),i=1/e.getZoomY();this._maskArea(e,t,a);var s=o.globalCompositeOperation,l=o.fillStyle;o.globalCompositeOperation="destination-out",o.fillStyle="#ffffff",o.beginPath(),o.moveTo(Math.round(r[0].x*n),Math.round(r[0].y*i));for(var c=1;c<r.length;c++)o.lineTo(Math.round(r[c].x*n),Math.round(r[c].y*i));o.lineTo(Math.round(r[0].x*n),Math.round(r[0].y*i)),o.fill(),o.globalCompositeOperation=s,o.fillStyle=l,o.fill(),o.restore(),t.ctx.masked&&(o.save(),this._maskAllArea(e,t))}},xa._maskAllArea=function(e,t){var a=t.canvas.getContext("2d"),r=1/e.getZoomX(),o=1/e.getZoomY();for(a.beginPath(),i=0;i<t.ctx._uArea.length;i++)if(buf=t.ctx._uArea[i]){for(a.moveTo(Math.round(buf[0].x*r),Math.round(buf[0].y*o)),j=1;j<buf.length;j++)a.lineTo(Math.round(buf[j].x*r),Math.round(buf[j].y*o));a.lineTo(Math.round(buf[0].x*r),Math.round(buf[0].y*o))}a.clip(),a.beginPath(),a.closePath(),t.ctx.masked=!0},xa._maskArea=function(e,t,a){var r;if(t.ctx._uArea&&(r=t.ctx._uArea[a])){var o=t.canvas.getContext("2d"),n=1/e.getZoomX(),i=1/e.getZoomY();t.ctx.masked&&o.restore(),o.save(),o.beginPath(),o.moveTo(Math.round(r[0].x*n),Math.round(r[0].y*i));for(var s=1;s<r.length;s++)o.lineTo(Math.round(r[s].x*n),Math.round(r[s].y*i));o.lineTo(Math.round(r[0].x*n),Math.round(r[0].y*i)),o.clip(),o.beginPath(),o.closePath()}},xa._stackSave=function(e,t){t.ctx.uOffCvs2||(t.ctx.uOffCvs2=t.$TAG("canvas",{style:"position:absolute;display:none;"}),t.ctx.uOffCvs2.width=parseInt(t.style.width),t.ctx.uOffCvs2.height=parseInt(t.style.height),t.ctx.uOffCvs2.style.width=t.style.width,t.ctx.uOffCvs2.style.height=t.style.height);var a=t.ctx.uOffCvs2.getContext("2d");a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(t.canvas,0,0),t.ctx._allStrokeSaved=t.ctx._allStroke.concat()},xa._stackRestore=function(e,t){if(t.ctx.uOffCvs2){var a=t.canvas.getContext("2d");a.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawImage(t.ctx.uOffCvs2,0,0)}t.ctx._allStrokeSaved&&(t.ctx._allStroke=t.ctx._allStrokeSaved.concat())},xa._sprayPen=function(e,t,a,r,o){var n=apn.UTIL.toRGBA(e.ctx.curStrokeStyle),i=t.createRadialGradient(a,r,.5*o,a,r,o);i.addColorStop(0,"rgba("+n.r+","+n.g+","+n.b+","+.09*n.a+")"),i.addColorStop(1,"rgba("+n.r+","+n.g+","+n.b+",0.0)"),t.fillStyle=i,t.beginPath(),t.arc(a,r,o,0,2*Math.PI),t.fill(),t.closePath()},xa._applyTool=function(e,t,a){var r=e.wgtTag(t),o=e.wgtGetProperty(t,"cfg");if(30==r.ctx.state)return!1;void 0===a?a=r.ctx.curTool:r.ctx.curTool=a;var n=r.canvas.getContext("2d");r.ctx.masked&&n.restore(),"pen"==a?(r.ctx.state=10,n.strokeStyle=r.ctx.curStrokeStyle):"hlpen"==a?(r.ctx.uOffCvs||(r.ctx.uOffCvs=r.$TAG("canvas",{style:"position:absolute;display:none;"}),r.ctx.uOffCvs.width=parseInt(r.style.width),r.ctx.uOffCvs.height=parseInt(r.style.height),r.ctx.uOffCvs.style.width=r.style.width,r.ctx.uOffCvs.style.height=r.style.height,r.ctx.uOffCvs.style.left="0px",r.ctx.uOffCvs.style.top="0px",e.tagPassPointerEvent(r.ctx.uOffCvs,!0)),r.ctx.state=12):"eraser"==a?r.ctx.state=10:(r.ctx.state=11,n.strokeStyle=r.ctx.curStrokeStyle),"eraser"==a?n.globalCompositeOperation="destination-out":n.globalCompositeOperation="source-over",n.lineWidth=Math.ceil((o.size[a]||11)*(1/e.getZoomX())),r.ctx.masked&&(n.save(),this._maskAllArea(e,r))},xa._buildAreaInfo=function(e,t,a){if(a&&a.area){for(var r=a.area,o={},n=0;n<r.length;n++)r[n].id&&e.objects[r[n].id]?o[r[n].id]=!0:(r.splice(n,1),n--);var i=apx.searchWidgets(e,1,void 0,t);for(n=0;n<i.length;n++)o[i[n]]||r.push({id:i[n]})}},xa.createAsCanvasObject=function(e,t,a,r,o){return apn.IWidget.createCanvasObject(e,this,"apn.CNoneClipLayerContainer",bx.CCanvasWnd.SHAPE_RECT,t,a,r,o)},xa.WGTS_SHOW=["apn.wgt.rect","apn.wgt.ellipse","apn.wgt.polygon","apn.wgt.polycurve"],xa.onEdit=function(e,t,a,r,o){var n=e.getObjectByID(t);"apn.CNoneClipLayerContainer"==n.module&&apn.widgets.utils.editWidget(n,e,2,!1,{wgtsShow:this.WGTS_SHOW,wgtsShowOverride:!0},o)},xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,o);for(var a=0;a<r.pen.length;a++)void 0===r.pen[a].apxIndex&&(r.pen[a].apxIndex=r.penIndex++);e.wgtSetProperty(t,"cfg",r)}var r=e.wgtGetProperty(t,"cfg");r.area=r.area||[{id:""}],r.areaC=r.areaC||"",this._buildAreaInfo(e.getScreenData(),t,r);var o;if(o=e.dlgDoModal(600,Math.ceil(.8*bx.UX.height),a)){o.style.padding="12px",o.style.boxSizing="border-box";var n={type:"title",title:apn.CExe.GL({ko:"색상 팔레트",en:"Color palette",ja:"カラーパレット"})};apn.CExe.edtSetupAddHelp(n,"edu.wgt.sketchPad"),eduLib.edtInputAdd(e,o,n),eduLib.edtInputAdd(e,o,{type:"table",value:r.pen,options:{th:[apn.CExe.GL({ko:"제목",en:"Name",ja:"タイトル"})+" (m)",apn.CExe.GL({ko:"색상",en:"Color",ja:"色"})+" (m)"],add:!0,remove:!0,noNumber:!0},td:[{type:"text",key:"name"},{type:"color",key:"clr",width:"120px"}],join:!0}),eduLib.edtInputAdd(e,o,{type:"space"}),n={type:"title",title:apn.CExe.GL({ko:"스트로크 초기 굵기",en:"Initial stroke weight",ja:"ストローク初期の太さ"})},apn.CExe.edtSetupAddHelp(n,"edu.wgt.sketchPad"),eduLib.edtInputAdd(e,o,n),eduLib.edtInputAdd(e,o,{type:"select",title:apn.CExe.GL({ko:"펜",en:"Pen",ja:"ペン"})+"[px]",options:xa.DEP_LN,value:r.size,key:"pen",join:!0}),eduLib.edtInputAdd(e,o,{type:"select",title:apn.CExe.GL({ko:"형광펜",en:"Highlighter",ja:"蛍光ペン"})+"[px]",options:xa.DEP_HL,value:r.size,key:"hlpen",join:!0}),eduLib.edtInputAdd(e,o,{type:"select",title:apn.CExe.GL({ko:"스프레이",en:"Spray",ja:"スプレー"})+"[px]",options:xa.DEP_SP,value:r.size,key:"spray",join:!0}),eduLib.edtInputAdd(e,o,{type:"select",title:apn.CExe.GL({ko:"지우개",en:"Eraser",ja:"消しゴム"})+"[px]",options:xa.DEP_ER,value:r.size,key:"eraser",join:!0}),eduLib.edtInputAdd(e,o,{type:"space"});var i=e.getScreenData(),s=[];for(var l in i.objects)if(apn.Project.findParentOf(i,l,void 0,!0,!0)==t){var c=apn.Project.getWidgetModule(i.objects[l].create.data);l!=t&&c&&c.exePropGet&&c.exePropGet(this,l,"vertex",!0)&&s.push({value:l,title:e.itrGetObjectTitle(l)})}eduLib.utilSortObjectsByTitle(e,s),s.push({value:"",title:apn.CExe.GL(apn.CExe.TXT_SETUP_NOSEL)}),n={type:"title",title:apn.CExe.GL({ko:"그리기 영역 목록",en:"List of areas to sketch",ja:"描画領域のリスト"})},apn.CExe.edtSetupAddHelp(n,"edu.wgt.sketchPad"),eduLib.edtInputAdd(e,o,n);var p;for(l=0;l<r.area.length;l++)if(r.area[l].id){p=!0;break}p?(eduLib.edtInputAdd(e,o,{type:"table",value:r.area,options:{th:[{title:apn.CExe.GL({ko:"영역 위젯",en:"Area widget",ja:"領域ウィジェット"})}],order:!0},td:[{type:"select",key:"id",readonly:!0,options:s}],join:!0}),eduLib.edtInputAdd(e,o,{type:"select",title:apn.CExe.GL({ko:"등록된 영역만 그리기",en:"Sketch only registered area",ja:"登録された領域のみ描画"}),key:"areaC",value:r,options:[{title:apn.CExe.GL({ko:"예",en:"Yes",ja:"はい"}),value:"Y"},{title:apn.CExe.GL({ko:"아니오",en:"No",ja:"いいえ"}),value:""}],join:!0})):eduLib.edtInputAdd(e,o,{type:"message",value:apn.CExe.GL({ko:"내부에 편집된 위젯이 없습니다.",en:"Any widget is not found in this widget.",ja:"内部に編集されたウィジェットがありません。"}),join:!0})}},xa.edtOnBuildState=function(e,t,a,r){var o,n=e.pages[a].objects[t].create.data,i=n&&n.properties?n.properties.attrs:void 0;if(r.pen="Pen",r.spray="Spray",r.eraser="Eraser",r.hlpen="Highlighter",r.save="Save",r.restore="Restore",r.clear="Reset",i&&i.cfg&&i.cfg.area&&"Y"==i.cfg.areaC){var s=i.cfg.area;for(o=0;o<s.length;o++)s[o].id&&e.pages[a].objects[s[o].id]&&(r["clear_"+o]="Reset "+(o+1))}if(i&&i.cfg&&i.cfg.pen)for(n=n.properties.attrs.cfg.pen,o=0;o<n.length;o++)r["color:"+n[o].apxIndex]="Color "+(n[o].name||n[o].clr);for(o=0;o<this.DEP_LN.length;o++)r["sPen:"+this.DEP_LN[o]]="PenSize "+this.DEP_LN[o]+"px";for(o=0;o<this.DEP_HL.length;o++)r["sHlPen:"+this.DEP_HL[o]]="HighlighterSize "+this.DEP_HL[o]+"px";for(o=0;o<this.DEP_SP.length;o++)r["sSpray:"+this.DEP_SP[o]]="SpraySize "+this.DEP_SP[o]+"px";for(o=0;o<this.DEP_ER.length;o++)r["sEraser:"+this.DEP_ER[o]]="EraserSize "+this.DEP_ER[o]+"px"},xa.edtOnBuildEvent=function(e,t,a,r){var o,n={strokePreStart:"StrokePreStart",strokeStart:"StrokeStart",strokeEnd:"StrokeEnd"},i=e.pages[a].objects[t].create.data;if(o=i.properties.attrs.cfg.area)for(var s=0;s<o.length;s++)o[s].id&&e.pages[a].objects[o[s].id]&&(n["sS_"+s]="StrokeStart "+(s+1),n["sE_"+s]="StrokeEnd "+(s+1));i.properties.attrs.strokeEvent&&(n.stroke="Stroke"),r.wgtEvent={value:"wgtEvent",title:apn.P.eventTitle.wgtEvent,param:n}},xa.edtOnRemapObjectID=function(e,t,a){var r;if(r=t.properties.attrs.cfg.area)for(var o=0;o<r.length;o++)r[o].id&&(a[r[o].id]?r[o].id=a[r[o].id]:e.getScreenData().objects[r[o].id]||(r[o].id=""))},xa.edtOnEditCheck=function(e,t){return!(!t||!t.styles||void 0===t.styles.state)},xa.edtOnDraw=function(e,t,a,r,o,n,i,s){var l=e.getObjectByID(t);bx.CEditorWnd.CRect.prototype.onDraw.call(l,a,r-l.position.x,o-l.position.y)},xa.edtOnPostDraw=function(e,t,a,r,o,n,i,s){var l=e.getObjectByID(t);if("apn.CNoneClipLayerContainer"==l.module){var c=l.style.fillStyle;l.style.fillStyle=null,bx.CEditorWnd.CRect.prototype.onDraw.call(l,a,r-l.position.x,o-l.position.y),l.style.fillStyle=c}},eduWgtSketchPad=xa;
var xa;xa=apn.inheritWidget(apn.widgets["apn.wgt.image"]),xa.editor={},xa.editor.iconThumb="DB/EDU/imgs/wgts/thumbs/spriteAnimation.png",xa.editor.states={play:"Play",loop:"Loop",stop:"Stop"},xa.properties.state="stop",xa.properties.attrs={apxAnimate:!0,cfg:{frames:[{sprite:{mediaID:void 0},duration:42}],idStep:""}},xa.onEdit=void 0,xa.exeCreateTag=apn.widgets["apn.wgt.rect"].exeCreateTag,xa.exeRenderTag=apn.widgets["apn.wgt.rect"].exeRenderTag,xa.exeAssetLoad=void 0,xa.exeAssetPreload=function(e,t,a){function i(i,c,s){a(),uxWgtImgSprite._frame(e,n,n.ctx.cur),r.exeOnCheckContentLoad&&e.fireEvent("contentLoad","i",t,!0,e.project.property.allowImmediateContentLoad)}var r=this,n=e.wgtTag(t);n.ctx={},n.ctx.frames=[],n.ctx.cur=0,n.ctx.action=0,n.ctx.lastTickTime=0;for(var c=e.wgtGetProperty(t,"cfg"),s=0,o={},d=0;d<c.frames.length;d++)buf=bx.$cloneObject({},c.frames[d]),buf.duration=bx.$checkNaN(parseInt(buf.duration)),buf.sprite.mediaID&&buf.duration&&(o["sp"+d]={url:e.mediaURL(c.frames[d].sprite.mediaID)},s++,buf.img=o["sp"+d],n.ctx.frames.push(buf));s?(new apn.CRscLoader).load(e.project,o,i):a()},xa.exeOnLoad=function(e,t){function a(a,n){if(a==r.idStep&&n){if(!i.ctx.frames[n.current])return void e.log(t,"Invalid frame was requested to display by step interface. FrameIndex="+n.current);i.ctx.cur!=n.current&&n.current<i.ctx.frames.length&&(i.ctx.cur=n.current,uxWgtImgSprite._frame(e,i,i.ctx.cur))}}var i=e.wgtTag(t),r=e.wgtGetProperty(t,"cfg");bx.HCL.DV.isIE()&&bx.HCL.DV.isIE()<9?i.img=i.$TAG("img",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}):(i.canvas=i.$TAG("canvas",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}),i.canvas.width=parseInt(i.style.width),i.canvas.height=parseInt(i.style.height)),uxWgtImgSprite._frame(e,i,i.ctx.cur),r.idStep&&e.wgtListenProperty(t,"apxStep",a)},xa.exeOnCheckContentLoad=function(e,t,a){return{i:"Image"}},xa.exeSetState=function(e,t,a,i){"stop"==a?this._stop(e,t,!0):"play"==a?(t.ctx.action=1,t.ctx.lastTickTime=0,e.fireEvent("animation","Start",e.wgtId(t))):"loop"==a&&(t.ctx.action=2,t.ctx.lastTickTime=0,e.fireEvent("animation","Start",e.wgtId(t)))},xa.exeOnTick=function(e,t,a){var i=e.wgtTag(t);if(i.ctx&&i.ctx.frames.length&&0!=i.ctx.action){i.ctx._onceStarted=!0;var r;0==i.ctx.lastTickTime?(i.ctx.cur=0,r=!0):i.ctx.lastTickTime<a&&(r=!0,2==i.ctx.action?i.ctx.cur=(i.ctx.cur+1)%i.ctx.frames.length:(i.ctx.cur++,i.ctx.cur==i.ctx.frames.length&&(i.ctx.cur=0,this._stop(e,i),r=!1))),r&&(i.ctx.lastTickTime=a+parseInt(i.ctx.frames[i.ctx.cur].duration),uxWgtImgSprite._frame(e,i,i.ctx.cur))}},xa._frame=function(e,t,a){if(t.ctx.frames[a]&&t.ctx.frames[a].img.image)if(t.canvas){var i=t.canvas.getContext("2d");i.clearRect(0,0,i.canvas.width,i.canvas.height),i.drawImage(t.ctx.frames[a].img.image,0,0,i.canvas.width,i.canvas.height)}else t.img&&(t.img.src=t.ctx.frames[a].img.url)},xa._stop=function(e,t,a){t.ctx.action=0,t.ctx.lastTickTime=0,a&&t.ctx.frames[0]&&t.ctx.frames[0].sprite.mediaID&&(t.ctx.cur=0,uxWgtImgSprite._frame(e,t,0)),t.ctx._onceStarted&&e.fireEvent("animation","End",e.wgtId(t))},xa.edtSetupStep=function(e,t,a,i){var r=e.getScreenData(),n=[{title:apn.CExe.GL({ko:"[없음]",en:"[None]",ja:"[なし]"}),value:""}];for(var c in r.objects)r.objects[c].create&&r.objects[c].create.data&&r.objects[c].create.data.properties&&r.objects[c].create.data.properties.attrs&&r.objects[c].create.data.properties.attrs.apxStep&&n.push({value:c,title:e.itrGetObjectTitle(c)});eduLib.edtInputAdd(e,a,{type:"select",options:n,title:apn.CExe.GL({ko:"연동할 위젯",en:"Widget to interface with",ja:"連動するウィジェット"}),key:"idStep",value:i,join:!0})},xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,r.tagTab1),eduLib.edtInputApplyAll(e,r.tagTab2),n.frames[0].sprite.mediaID&&e.wgtSetProperty(t,"apxMediaID",n.frames[0].sprite.mediaID),e.wgtSetProperty(t,"cfg",n),e.wgtRefreshUI(t)}function i(){for(var e in c)c[e]&&(this.id==e?(r[e].style.display="block",r.tagTab.$$(e).style.borderStyle="solid solid none solid"):(r[e].style.display="none",r.tagTab.$$(e).style.borderStyle="none none solid none"));uxWgtImgSprite._uiLastSetupTab=this.id}var r,n=e.wgtGetProperty(t,"cfg"),c={tagTab1:!0,tagTab2:!0};if(r=e.dlgDoModal(600,Math.ceil(.9*bx.UX.height),a)){var s=apn.CExe.CSS_SETUP_PANE+"height:"+(r.clientHeight-40)+"px";r.tagTab=r.$TAG("div",{style:"position:relative;font-weight:bold;width:100%;height:26px;padding-bottom:14px;"}),r.tagTab.innerHTML='<span id="tagTab1" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스프라이트",en:"Sprite Sheet",ja:"スプライト"})+'</span><span id="tagTab2" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스텝 연동",en:"Step Interface",ja:"ステップ連動"})+"</span>"+apn.CExe.CSS_SETUP_TAB_END,r.tagTab.$$("tagTab1").onclick=r.tagTab.$$("tagTab2").onclick=i,r.tagTab1=r.$TAG("div",{style:s}),r.tagTab2=r.$TAG("div",{style:s}),eduLib.edtInputAdd(e,r.tagTab1,{type:"table",value:n.frames,options:{th:[apn.CExe.GL({ko:"프레임 이미지",en:"Frame image",ja:"フレーム画像"}),apn.CExe.GL({ko:"프레임 시간",en:"Duration",ja:"フレーム時間"})+"[ms]"],add:!0,remove:!0,order:!0},td:[{type:"image",key:"sprite"},{type:"text",key:"duration",width:"110px"}],join:!0}),eduLib.edtInputAdd(e,r.tagTab1,{type:"message",value:"※ "+apn.CExe.GL({ko:"과도한 이미지의 사용은 HTML5 컨텐츠의 성능을 크게 저하시킵니다. 그러한 경우, Video로 제작하거나 Scene Animation으로 편집하는 것이 좋습니다.",en:"Excessive image resources will slow down HTML5 contents. In that case, video or Scene Animation is better.",ja:"過度な画像の使用は、HTML5コンテンツのパフォーマンスを大幅に低下させます。その場合、Videoでの製作や、Scene Animationでの編集をお勧めします。"}),join:!0}),this.edtSetupStep(e,t,r.tagTab2,n),void 0!==uxWgtImgSprite._uiLastSetupTab&&r.tagTab.$$(uxWgtImgSprite._uiLastSetupTab)?r.tagTab.$$(uxWgtImgSprite._uiLastSetupTab).onclick():r.tagTab.$$("tagTab1").onclick(),r.tagTab.$$("tagBlank").style.width=r.clientWidth-r.tagTab.$$("tagBlank").offsetLeft-1+"px"}},xa.edtOnRemapObjectID=function(e,t,a){if(t&&t.properties&&t.properties.attrs&&t.properties.attrs.cfg){var i=t.properties.attrs.cfg;i.idStep&&(a[i.idStep]?i.idStep=a[i.idStep]:e.getScreenData().objects[i.idStep]||(i.idStep=""))}},uxWgtImgSprite=xa,xa=apn.inheritWidget(uxWgtImgSprite),xa.properties.attrs.imgCropSprite=!0,xa.properties.attrs.ver=2,xa.properties.attrs.cfg={ty:"s",mr:0,s:{img:{mediaID:void 0},w:64,h:64,cnt:1,cols:0,x:0,y:0,tm:42},f:{file:{size:0,data:""},edt:{}},idStep:""},xa.scriptInfo={wgtData:{sheet:{help:"{type:'simple', data:{img:{mediaID:id}, w:Number, h:Number, cnt:Number, x:Number, y:Number, tm:Msec}\nSprite sheet data.",type:"so"}},wgtRun:{showFrame:{param:"1-based Number",help:{ko:"지정된 프레임을 표시합니다.",en:"Show the designated frame",ja:"指定されたフレームを表示します。"}}}},xa.exeCreateTag=apn.widgets["apn.wgt.rect"].exeCreateTag,xa.exeRenderTag=function(e,t,a,i,r,n){return apn.widgets["apn.wgt.rect"].exeRenderTag.call(this,e,t,a,i,r,n),a.tagOnPostResize=function(e,t){if(t.ctx.cellHolder){var a=e.wgtGetProperty(t.apnOID,"cfg"),i=1,r=parseInt(t.style.width)/(a.s.w*i),n=parseInt(t.style.height)/(a.s.h*i);r=parseInt(t.style.width)/a.s.w,n=parseInt(t.style.height)/a.s.h,t.ctx.cellHolder.$CSS({transform:"scale("+r*i+","+n*i+")",transformOrigin:"0px 0px"})}},a},xa.exeAssetPreload=function(e,t,a){function i(i,o,d){r.ctx.image=c.sp.image,s._loadSpriteSheet(e,t,n),a(),s.exeOnCheckContentLoad&&e.fireEvent("contentLoad","i",t,!0,e.project.property.allowImmediateContentLoad)}var r=e.wgtTag(t);r.ctx={},r.ctx.cur=0,r.ctx.action=0,r.ctx.lastTickTime=0,r.ctx.frames=[];var n=e.wgtGetProperty(t,"cfg");if(n.s.img.mediaID){var c={},s=this;c.sp={url:e.mediaURL(n.s.img.mediaID)},(new apn.CRscLoader).load(e.project,c,i)}else a()},xa.exeOnCheckContentLoad=function(e,t,a){return{i:"Image"}},xa.exeOnLoad=function(e,t){function a(a,i){function n(a,n,o){a==n&&(r.ctx.image=s.sp.image,i.data.h=s.sht.image.height,i.data.w=Math.max(1,s.sht.image.width/i.data.cnt),c._loadSpriteSheet(e,t,{ty:"s",s:i.data}))}if(a==t&&i&&i.type&&i.data&&i.data.img&&i.data.img.mediaID&&i.data.cnt&&"simple"==i.type)if(i.data.w&&i.data.h)c._loadSpriteSheet(e,t,{ty:"s",s:i.data});else{var s={};s.sht={url:e.mediaURL(i.data.img.mediaID)},(new apn.CRscLoader).load(e.project,s,n)}}function i(a,i){if(a==n.idStep&&i){if(!r.ctx.frames[i.current])return void e.log(t,"Invalid frame was requested to display by step interface. FrameIndex="+i.current);r.ctx.cur!=i.current&&i.current<r.ctx.frames.length&&(r.ctx.cur=i.current,c._render(e,r,r.ctx.frames[r.ctx.cur]))}}var r=e.wgtTag(t),n=e.wgtGetProperty(t,"cfg"),c=this;if(e.wgtListenProperty(t,"sheet",a),n.idStep){var c=this;e.wgtListenProperty(t,"apxStep",i)}},xa._loadSpriteSheet=function(e,t,a){var i=e.wgtTag(t);if(i){if("s"==a.ty&&a.s.img.mediaID&&a.s.w&&a.s.h&&a.s.cnt&&a.s.tm)for(var r=a.s.cols||a.s.cnt,n=x=bx.$checkNaN(parseInt(a.s.x))||0,c=bx.$checkNaN(parseInt(a.s.y))||0,s=0;s<a.s.cnt;s++)i.ctx.frames[s]={x:x,y:c,w:a.s.w,h:a.s.h,offX:0,offY:0,tm:a.s.tm},x+=a.s.w,(s+1)%r==0&&(x=n,c+=a.s.h);else if("f"==a.ty&&a.f&&a.f.file&&a.f.file.data){try{var o=JSON.parse(a.f.file.data)}catch(a){e.log(t,"JSON file parsing error:"+a)}if(o&&o.frames)for(var s in o.frames)o.frames[s].frame&&i.ctx.frames.push({x:o.frames[s].frame.x,y:o.frames[s].frame.y,w:o.frames[s].frame.w,h:o.frames[s].frame.h,offX:o.frames[s].spriteSourceSize.x,offY:o.frames[s].spriteSourceSize.y,tm:a.s.tm})}if(i.ctx.useCanvas=!1,2!=e.wgtGetProperty(t,"ver")||bx.HCL.DV.isIE()&&bx.HCL.DV.isIE()<9||(i.ctx.useCanvas=!0),i.ctx.cellInfo=a,i.ctx.useCanvas){if(i.ctx.cell=i.$TAG("canvas",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}),i.ctx.cell.width=parseInt(i.style.width),i.ctx.cell.height=parseInt(i.style.height),i.ctx.cvsCtx=i.ctx.cell.getContext("2d"),a.mr&&(1==a.mr?(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateY(180deg)")):2==a.mr?(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateX(180deg)")):3==a.mr&&(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateX(180deg) rotateY(180deg)"))),i.ctx.frames.length){var d=0;void 0!==i.ctx._delayedFrame&&i.ctx._delayedFrame>=0&&i.ctx._delayedFrame<i.ctx.frames.length&&(d=i.ctx._delayedFrame,delete i.ctx._delayedFrame),this._render(e,i,i.ctx.frames[d])}}else if(a.mr?(i.ctx.cellHolderMr=i.ctx.cellHolderMr||i.$TAG("div",{style:"cursor:inherit;width:100%;height:100%;"}),i.ctx.cellHolder=i.ctx.cellHolder||i.ctx.cellHolderMr.$TAG("div"),1==a.mr?(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateY(180deg)")):2==a.mr?(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateX(180deg)")):3==a.mr&&(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateX(180deg) rotateY(180deg)"))):i.ctx.cellHolder=i.ctx.cellHolder||i.$TAG("div"),i.ctx.cellHolder.$A({style:"cursor:inherit;width:"+a.s.w+"px;height:"+a.s.h+"px"}),i.ctx.cell=i.ctx.cell||i.ctx.cellHolder.$TAG("div"),i.ctx.cell.$A({style:"cursor:inherit;position:absolute;left:0px;top:0px;width:"+a.s.w+"px;height:"+a.s.h+"px"}),i.ctx.frames.length){i.tagOnPostResize(e,i),i.ctx.cell.style.backgroundImage="url("+e.mediaURL(a.s.img.mediaID)+")",i.ctx.cell.style.backgroundRepeat="no-repeat";var d=0;void 0!==i.ctx._delayedFrame&&i.ctx._delayedFrame>=0&&i.ctx._delayedFrame<i.ctx.frames.length&&(d=i.ctx._delayedFrame,delete i.ctx._delayedFrame),this._render(e,i,i.ctx.frames[d])}}},xa.exeOnTick=function(e,t,a){var i=e.wgtTag(t);if(i.ctx.frames.length&&0!=i.ctx.action){i.ctx._onceStarted=!0;var r;0==i.ctx.lastTickTime?(i.ctx.cur=0,r=!0):i.ctx.lastTickTime<a&&(r=!0,2==i.ctx.action?i.ctx.cur=(i.ctx.cur+1)%i.ctx.frames.length:(i.ctx.cur++,i.ctx.cur==i.ctx.frames.length&&(i.ctx.cur=0,this._stop(e,i),r=!1))),r&&(i.ctx.lastTickTime=a+i.ctx.frames[i.ctx.cur].tm,this._render(e,i,i.ctx.frames[i.ctx.cur]))}},xa.exePropSet=function(e,t,a,i,r){if("showFrame"==a){if(r)return!0;var n=e.wgtTag(t);n.ctx&&(n.ctx.frames.length?i>0&&i<=n.ctx.frames.length?this._render(e,n,n.ctx.frames[i-1]):e.log(t,"Invalid frame was requested by Widget:run(). FrameIndex="+i):n.ctx._delayedFrame=i-1)}},xa._render=function(e,t,a){if(t.ctx.useCanvas)t.ctx.image&&(t.ctx.cvsCtx.clearRect(0,0,t.ctx.cell.width,t.ctx.cell.height),t.ctx.cvsCtx.drawImage(t.ctx.image,a.x,a.y,a.w,a.h,Math.round(a.offX*(1/e.getZoomX())),Math.round(a.offY*(1/e.getZoomY())),t.ctx.cell.width-Math.round(a.offX*(1/e.getZoomX())),t.ctx.cell.height-Math.round(a.offY*(1/e.getZoomY()))));else{var i=t.ctx.cell.style;i.left!=a.offX+"px"&&(i.left=a.offX+"px"),i.top!=a.offY+"px"&&(i.top=a.offY+"px"),i.width!=a.w+"px"&&(i.width=a.w+"px"),i.height!=a.h+"px"&&(i.height=a.h+"px"),i.backgroundPosition=-a.x+"px "+-a.y+"px"}},xa._stop=function(e,t,a){t.ctx.action=0,t.ctx.lastTickTime=0,a&&t.ctx.frames[0]&&this._render(e,t,t.ctx.frames[0]),t.ctx._onceStarted&&e.fireEvent("animation","End",e.wgtId(t))},xa.edtOnConfig=function(e,t){function a(){if(eduLib.edtInputApplyAll(e,c.tagTab1),eduLib.edtInputApplyAll(e,c.tagTab2),n.s.img.mediaID&&e.wgtSetProperty(t,"apxMediaID",n.s.img.mediaID),"f"==n.ty&&(n.f.edt.w=n.f.edt.h=0,n.f.file.data)){try{var a=JSON.parse(n.f.file.data)}catch(e){}if(a&&a.frames)for(var i in a.frames){n.f.edt.x=a.frames[i].frame.x,n.f.edt.y=a.frames[i].frame.y,n.f.edt.w=a.frames[i].frame.w,n.f.edt.h=a.frames[i].frame.h,n.f.edt.offX=a.frames[i].spriteSourceSize.x,n.f.edt.offY=a.frames[i].spriteSourceSize.y,n.s.w=a.frames[i].sourceSize.w,n.s.h=a.frames[i].sourceSize.h;break}}e.wgtSetProperty(t,"ver",2),e.wgtSetProperty(t,"cfg",n),e.wgtRefreshUI(t)}function i(){"s"==this.value?(eduLib.edtInputShow(e,c.tagTab1,"s",!0),eduLib.edtInputShow(e,c.tagTab1,"f",!1)):(eduLib.edtInputShow(e,c.tagTab1,"f",!0),eduLib.edtInputShow(e,c.tagTab1,"s",!1))}function r(){for(var e in s)s[e]&&(this.id==e?(c[e].style.display="block",c.tagTab.$$(e).style.borderStyle="solid solid none solid"):(c[e].style.display="none",c.tagTab.$$(e).style.borderStyle="none none solid none"));uxWgtShtSprite._uiLastSetupTab=this.id}var n=e.wgtGetProperty(t,"cfg");n.f=n.f||{file:{size:0,data:""},edt:{}};var c,s={tagTab1:!0,tagTab2:!0};if(c=e.dlgDoModal(600,700,a)){var o=apn.CExe.CSS_SETUP_PANE+"height:"+(c.clientHeight-40)+"px";c.tagTab=c.$TAG("div",{style:"position:relative;font-weight:bold;width:100%;height:26px;padding-bottom:14px;"}),c.tagTab.innerHTML='<span id="tagTab1" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스프라이트",en:"Sprite Sheet",ja:"スプライト"})+'</span><span id="tagTab2" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스텝 연동",en:"Step Interface",ja:"ステップ連動"})+"</span>"+apn.CExe.CSS_SETUP_TAB_END,c.tagTab.$$("tagTab1").onclick=c.tagTab.$$("tagTab2").onclick=r,c.tagTab1=c.$TAG("div",{style:o}),c.tagTab2=c.$TAG("div",{style:o}),eduLib.edtInputAdd(e,c.tagTab1,{type:"image",title:apn.CExe.GL({ko:"스프라이트 시트 이미지",en:"Sprite sheet image",ja:"スプライトシートの画像"}),value:n.s,key:"img",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"message",value:"※ "+apn.CExe.GL({ko:"과도한 이미지의 사용은 HTML5 컨텐츠의 성능을 크게 저하시킵니다. 그러한 경우, Video로 제작하거나 Scene Animation으로 편집하는 것이 좋습니다.",en:"Excessive image resources will slow down HTML5 contents. In that case, video or Scene Animation is better.",ja:"過度な画像の使用は、HTML5コンテンツのパフォーマンスを大幅に低下させます。その場合、Videoでの製作や、Scene Animationでの編集をお勧めします。"}),join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"space"}),eduLib.edtInputAdd(e,c.tagTab1,{type:"title",title:apn.CExe.GL({ko:"프레임 구성 정보",en:"Frame information",ja:"フレーム構成情報"})}),eduLib.edtInputAdd(e,c.tagTab1,{type:"select",title:apn.CExe.GL({ko:"스프라이트 시트 구성",en:"Sprite sheet type",ja:"スプライトシートの構成"}),value:n,key:"ty",options:[{title:"Simple",value:"s"},{title:"Adobe Animate - JSON",value:"f"}],onchange:i,join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"number",title:apn.CExe.GL({ko:"프레임 시간",en:"Duration",ja:"フレーム時間"})+"[ms] (m)",value:n.s,key:"tm",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 너비",en:"Cell width",ja:"フレームセルの幅"})+"[px] (m)",value:n.s,key:"w",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 높이",en:"Cell height",ja:"フレームセルの高さ"})+"[px](m)",value:n.s,key:"h",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 개수",en:"Cell count",ja:"フレームセル数"})+" (m)",value:n.s,key:"cnt",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 열의 수",en:"Column count",ja:"フレームセル列の数"}),value:n.s,key:"cols",comment:"("+apn.CExe.GL({ko:"1개 행으로 구성된 경우, 0을 입력",en:"0 if cells are aligned in one line",ja:"1つの行で構成された場合、0を入力"})+")",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"시작 X좌표",en:"Start X",ja:"開始X座標"})+"[px]",value:n.s,key:"x",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"시작 Y좌표",en:"Start Y",ja:"開始Y座標"})+"[px]",value:n.s,key:"y",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"f",type:"file",title:apn.CExe.GL({ko:"프레임 구성 정보 파일",en:"Frame information file",ja:"フレーム構成情報ファイル"}),value:n.f,key:"file",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"space"}),eduLib.edtInputAdd(e,c.tagTab1,{type:"title",title:apn.CExe.GL({ko:"대칭 변환",en:"Mirror transformation",ja:"対称変換"})}),eduLib.edtInputAdd(e,c.tagTab1,{type:"select",title:apn.CExe.GL({ko:"방향",en:"Direction",ja:"方向"}),value:n,key:"mr",options:[{title:apn.CExe.GL({ko:"가로",en:"Horizontal",ja:"横"}),value:1},{title:apn.CExe.GL({ko:"세로",en:"Vertical",ja:"縦"}),value:2},{title:apn.CExe.GL({ko:"가로&세로",en:"Both",ja:"横＆縦"}),value:3},{title:apn.CExe.GL({ko:"안함",en:"None",ja:"無効"}),value:0}],join:!0}),uxWgtImgSprite.edtSetupStep(e,t,c.tagTab2,n),void 0!==uxWgtShtSprite._uiLastSetupTab&&c.tagTab.$$(uxWgtShtSprite._uiLastSetupTab)?c.tagTab.$$(uxWgtShtSprite._uiLastSetupTab).onclick():c.tagTab.$$("tagTab1").onclick(),c.tagTab.$$("tagBlank").style.width=c.clientWidth-c.tagTab.$$("tagBlank").offsetLeft-1+"px"}},xa.edtOnFitToSize=function(e,t,a){if(a.cfg.s&&a.cfg.s.w&&a.cfg.s.h)return{w:a.cfg.s.w,h:a.cfg.s.h}},uxWgtShtSprite=xa;
var xa=apn.inheritWidget(apn.widgets["apn.wgt.image2"]);xa.exeFireStateEvent=!0,xa.styleMap={title:!0,visibility:!0,strokeStyle:!0,lineWidth:!0,lineDash:!0,font:!0,fontSize:!0,fontStyle:!0,fontItalic:!0,fontBold:!0,textMultiLine:!0,fontUnderlined:!0,text:!0,textAlign:!0,textValign:!0,textPadding:!0,fontStrokeStyle:!0,fontStrokeWidth:!0,borderRadiusTopLeft:!0,borderRadiusTopRight:!0,borderRadiusBottomLeft:!0,borderRadiusBottomRight:!0,alpha:!0,angle:!0,mediaID:!0,dragX:!0,dragY:!0,dragInParent:!0,dragContainParent:!0,csr:!0},xa.editor={},xa.editor.iconThumb="DB/ux/imgs/wgts/thumbs/imageButton.png",xa._txtSpt1={ko:"기본 상태 이미지 ID",en:"Image asset ID for normal state",ja:"基本状態の画像ID"},xa._txtSpt2={ko:"선택 상태 이미지 ID",en:"Image asset ID for selected state",ja:"選択状態の画像ID"},xa.scriptInfo={wgtDataByParam:"selectType",wgtData:{"":{image:{help:"{normal:ID|undefined, pressed:ID|undefined, hover:ID|undefined}\n"+apn.CExe.GL(xa._txtSpt1),type:"so",value:{}},imageDisabled:{help:"{normal:ID|undefined}\n"+apn.CExe.GL({ko:"비활성 상태 이미지 ID",en:"Image asset ID for disabled state",ja:"非アクティブの画像ID"}),type:"so",value:{}}},tab:{image:{help:"{normal:ID|undefined, hover:ID|undefined}\n"+apn.CExe.GL(xa._txtSpt1),type:"so",value:{}},imageSelected:{help:"{normal:ID|undefined}\n"+apn.CExe.GL(xa._txtSpt2),type:"so",value:{}}},check:{image:{help:"{normal:ID|undefined, hover:ID|undefined}\n"+apn.CExe.GL({ko:"미선택 상태 이미지 ID",en:"Image asset ID for unchecked state",ja:"未選択状態の画像ID"}),type:"so",value:{}},imageChecked:{help:"{normal:ID|undefined, hover:ID|undefined}\n"+apn.CExe.GL(xa._txtSpt2).replace("selected","checked"),type:"so",value:{}}}}},xa.properties.state="normal",xa.properties.attrs=xa.properties.attrs||{},xa.properties.attrs.selectType="",xa.properties.attrs.btnV=2,xa.properties.attrs.autoKeepSize=!1,xa.properties.attrs.cfg={images:{normal:{mediaID:void 0},down:{mediaID:void 0},hover:{mediaID:void 0},disabled:{mediaID:void 0},disabledDown:{mediaID:void 0},disabledHover:{mediaID:void 0},checked:{mediaID:void 0},checkedD:{mediaID:void 0},checkedH:{mediaID:void 0}},clr:{disabled:null,down:null,hover:null},ttip:"",hvrSync:""},xa.onEdit=apn.widgets["apn.wgt.rect"].onEdit,xa.exeCreateTag=function(e,t,a,i,d,n){var o=apn.widgets["apn.wgt.rect"].exeCreateTag.call(this,e,t,a,i,d,n);return o.apnTapCsr=!0,o},xa.exeAssetPreload=function(e,t,a){function i(e,t,i){a()}var d=e.wgtGetProperty(t,"cfg"),n={},o=0;for(var r in d.images)d.images[r].mediaID&&(n[r]={url:e.mediaURL(d.images[r].mediaID)},o++);o?(new apn.CRscLoader).load(e.project,n,i):a()},xa.exeOnLoad=function(e,t){function a(){if(e.wgtTag(t)){var a="hover";if("toggle"==x)"disabled"==e.wgtGetProperty(t,"apxState")&&(a="disabledHover");else if("check"==x)"checked"==e.wgtGetProperty(t,"apxState")&&(a="checkedH");else if("disabled"==e.wgtGetProperty(t,"apxState"))return;v._images[a].mediaID&&I.exeAssetLoad(e,v,v._images[a].mediaID),uxWgtBtnImage.setTextColor(e,t,a),I.I_exeOnStateChange&&I.I_exeOnStateChange(e,t,a)}}function i(){if(e.wgtTag(t)){if(v._down)if("check"==x)var a="checkedD";else var a="down";else var a=e.wgtGetProperty(t,"apxState");v._images[a].mediaID&&I.exeAssetLoad(e,v,v._images[a].mediaID),uxWgtBtnImage.setTextColor(e,t,a),I.I_exeOnStateChange&&I.I_exeOnStateChange(e,t,a)}}function d(){if(e.wgtTag(t)){var a="down";if("toggle"==x)"disabled"==e.wgtGetProperty(t,"apxState")&&(a="disabledDown");else if("check"==x);else if("disabled"==e.wgtGetProperty(t,"apxState"))return;v._images[a].mediaID&&I.exeAssetLoad(e,v,v._images[a].mediaID),uxWgtBtnImage.setTextColor(e,t,a),I.I_exeOnStateChange&&I.I_exeOnStateChange(e,t,a)}}function n(){var a=e.wgtGetProperty(t,"apxState");v._images[a]||(a="normal"),v._images[a].mediaID&&I.exeAssetLoad(e,v,v._images[a].mediaID),uxWgtBtnImage.setTextColor(e,t,a),I.I_exeOnStateChange&&I.I_exeOnStateChange(e,t,a)}function o(a){a?v.btnOnDown&&v.btnOnDown(v):v._down&&(v._down=!1,v.btnOnState&&v.btnOnState(v),b.hvrSync&&e.ctxSet("uxWgtBtnImage_"+b.hvrSync,{oId:t,state:3}))}function r(t,a,i,i,i,i,d){t.apnBlockPointerEvent||(a==bx.CGesture.POINTER_START?(d&&e.viewer.uOnGestureDragStartControl&&e.viewer.uOnGestureDragStartControl(d),o(!0)):a==bx.CGesture.POINTER_END&&o(!1))}function l(e){e&&e.oId!=t&&(m&&0==e.state?i():m&&1==e.state?a():y&&2==e.state?d():3==e.state&&n())}function s(a){a&&e.log(t,"Image can be set only to replace existing image. Currently, '"+a+"' image is unset for this widget.")}function p(e,a){if(e==t&&a){var i,d;a.normal&&(v._images.normal.mediaID?(v._images.normal.mediaID=a.normal,d=!0):i="Normal"),a.pressed&&(v._images.down.mediaID?(v._images.down.mediaID=a.pressed,d=!0):i="Pressed"),a.hover&&(v._images.hover.mediaID?(v._images.hover.mediaID=a.hover,d=!0):i="Hover"),d&&v.btnOnState&&v.btnOnState(v),s(i)}}function g(e,a){if(e==t&&a){var i,d;a.normal&&(v._images.disabled.mediaID?(v._images.disabled.mediaID=a.normal,d=!0):i="Disabled"),d&&v.btnOnState&&v.btnOnState(v),s(i)}}function u(e,a){if(e==t&&a){var i,d;a.normal&&(v._images.checked.mediaID?(v._images.checked.mediaID=a.normal,d=!0):i="Checked"),a.hover&&(v._images.checkedH.mediaID?(v._images.checkedH.mediaID=a.hover,d=!0):i="Checked.hover"),d&&v.btnOnState&&v.btnOnState(v),s(i)}}function c(e,a){if(e==t&&a){var i,d;a.normal&&(v._images.disabled.mediaID?(v._images.disabled.mediaID=a.normal,d=!0):i="Selected"),d&&v.btnOnState&&v.btnOnState(v),s(i)}}var m,y,I=this,v=e.wgtTag(t),b=e.wgtGetProperty(t,"cfg"),x=e.wgtGetProperty(t,"selectType");if(b.ttip&&(v.title=b.ttip),b.images.disabledDown||(b.images.disabledDown={mediaID:void 0}),b.images.disabledHover||(b.images.disabledHover={mediaID:void 0}),b.clr||(b.clr={disabled:null,down:null,hover:null}),!this.I_exeOnLoad_check||this.I_exeOnLoad_check(e,t)){v._images=bx.$cloneObject({},b.images),v._down=!1;var h=!1;if(apn.dbUI&&apn.dbUI.system&&1==apn.dbUI.system.exeEventStart){var S=apn.Project.getLayout(e.project).property.CExe;S&&S.event&&"Y"==S.event.TS1&&(h=!0)}"tab"==x||"toggle"==x?("tab"==x&&(v._images.down=v._images.disabled,v._images.hover.mediaID||(v._images.hover=v._images.disabled)),v.apxOnEvent=function(e,a,i,d){if(a==(h?"tapStart":"click"))return"toggle"==x?"normal"==e.wgtGetProperty(t,"apxState")?e.wgtSetProperty(t,"apxState","disabled"):e.wgtSetProperty(t,"apxState","normal"):"normal"==e.wgtGetProperty(t,"apxState")&&e.wgtSetProperty(t,"apxState","disabled"),!0}):"check"==x&&(v.apxOnEvent=function(e,a,i,d,n,n,o){if(a==(h?"tapStart":"click"))return"normal"==e.wgtGetProperty(t,"apxState")?e.wgtSetProperty(t,"apxState","checked"):e.wgtSetProperty(t,"apxState","normal"),!0}),h||(v._images.down.mediaID||b.clr&&b.clr.down||v._images.disabledDown.mediaID||b.clr&&b.clr.disabledDown)&&(y=!0,v.btnOnDown=function(a){if("toggle"==x);else if("check"==x);else if("disabled"==e.wgtGetProperty(t,"apxState"))return;v._down||(v._down=!0,d(),b.hvrSync&&e.ctxSet("uxWgtBtnImage_"+b.hvrSync,{oId:t,state:2}))}),v.btnOnState=function(e){n()},h||(v._images.hover.mediaID||b.clr&&b.clr.hover||v._images.disabledHover.mediaID||b.clr&&b.clr.disabledHover||b.clr&&b.clr.checkedH)&&(m=!0,bx.HCL.DV.hasTouchEvent()||(v.onmousemove=function(i){return!v.apnPassPointerEvent&&(!v.apnBlockPointerEvent&&void(v._down||(a(),b.hvrSync&&(v._btnHover||(v._btnHover=!0,e.ctxSet("uxWgtBtnImage_"+b.hvrSync,{oId:t,state:1}))))))},v.onmouseout=function(a){return!v.apnPassPointerEvent&&(!v.apnBlockPointerEvent&&(i(),void(b.hvrSync&&v._btnHover&&(v._btnHover=!1,v._down||e.ctxSet("uxWgtBtnImage_"+b.hvrSync,{oId:t,state:0})))))})),e.viewer.o.verGestureDispatch&&(v.apxOnGesture=function(e,t){r(this,t)}),new bx.CGesture(v,r,{noDelayedEvent:!0,noLongholdEvent:!0}),v.btnOnState&&v.btnOnState(v),b.hvrSync&&e.wgtListenContext(t,"uxWgtBtnImage_"+b.hvrSync,l,!0),e.wgtListenProperty(t,"image",p),e.wgtListenProperty(t,"imageDisabled",g),e.wgtListenProperty(t,"imageChecked",u),e.wgtListenProperty(t,"imageSelected",c),this.I_exeOnLoad_post&&this.I_exeOnLoad_post(e,t)}},xa.exeSetState=function(e,t,a,i){function d(t){"on"==e.wgtGetProperty(t,"apxState")?e.wgtSetProperty(t,"apxState","off",void 0,{stateInitialize:!0}):"disabled"==e.wgtGetProperty(t,"apxState")||"checked"==e.wgtGetProperty(t,"apxState")?e.wgtSetProperty(t,"apxState","normal",void 0,{stateInitialize:!0}):"2"==e.stateGetActive(t,!0)&&(e.stateLayerActivate(t,"1"),e.stateSetActive(t,"1",!0))}if(i!=a){var n=e.wgtGetProperty(e.wgtId(t),"selectType");"toggle"==n||"check"==n||setTimeout(function(){"normal"==a?"Block"==e.wgtGetProperty(t.apnOID,"apxVisibility")||2==e.wgtGetProperty(t.apnOID,"apxVisibility")||(e.tagBlockPointerEvent(t,!1),apn.IWidget.exeSetCursor(t,e.wgtGetProperty(t.apnOID,"apxCursor",!0))):(e.tagBlockPointerEvent(t,!0),apn.IWidget.exeSetCursor(t,"inherit"))},0),t.btnOnState&&t.btnOnState(t);var o=e.wgtId(t);e.wgtGetProperty(o,"uxToggleGroup")&&("disabled"!=a&&"checked"!=a||e.utlIterateInGroup(o,"uxToggleGroup",d))}},xa.exeOnScreenRefresh=apn.widgets["apn.wgt.rect"].exeOnScreenRefresh,xa.setTextColor=function(e,t,a){var i,d=e.wgtTag(t),n=e.wgtGetProperty(t,"cfg"),o=e.wgtGetProperty(t,"btnV"),r=!!e.wgtGetProperty(t,"apxText");r&&(i=d.textTag?d.textTag:d),i&&n.clr&&("normal"==a?(d==i?i.style.color=apn.Project.resolveStyle(e.project,"fontStyle",e.wgtGetProperty(t,"apxTextColor")):i.style.color="inherit",2==o&&(d.style.borderColor=apn.Project.resolveStyle(e.project,"strokeStyle",e.wgtGetProperty(t,"apxStrokeStyle")))):n.clr[a]&&(i.style.color=n.clr[a],2==o&&(d.style.borderColor=n.clr[a])))},xa.createAsCanvasObject=function(e,t,a,i,d){return apn.IWidget.createCanvasObject(e,this,"apn.CImage",bx.CCanvasWnd.SHAPE_RECT,t,a,i,d)},xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,i.tagSub),eduLib.edtInputApplyAll(e,i.tagOrg),r.edtOnSetState(e,t,e.wgtGetProperty(t,"apxState")),e.wgtSetProperty(t,"cfg",d),n&&(e.wgtSetProperty(t,"local",n),r.I_edtOnConfig_save&&r.I_edtOnConfig_save(e,t,n,i,i.tagSub,i.tagOrg)),i._tmpSelectType&&e.wgtSetProperty(t,"selectType",i._tmpSelectType)}var i,d=e.wgtGetProperty(t,"cfg"),n=e.wgtGetProperty(t,"local"),o=e.wgtGetProperty(t,"selectType");d.images.disabledDown||(d.images.disabledDown={mediaID:void 0}),d.images.disabledHover||(d.images.disabledHover={mediaID:void 0}),d.clr||(d.clr={disabled:null,down:null,hover:null});var r=this;(i=e.dlgDoModal(700,Math.ceil(.8*bx.UX.height),a))&&(i.tagSub=i.$TAG("div"),i.tagOrg=i.$TAG("div"),this.I_edtOnConfig&&this.I_edtOnConfig(e,t,n,i,i.tagSub,i.tagOrg),uxWgtBtnImage.I_edtOnConfigBuild.call(this,e,t,i,i.tagOrg,o))},xa.I_edtOnConfigBuild=function(e,t,a,i,d){var n=e.wgtGetProperty(t,"cfg");a._tmpSelectType=d;var o=apn.CExe.GL({ko:"비활성 상태",en:"Disabled",ja:"非アクティブ"}),r=apn.CExe.GL({ko:"기본 상태",en:"Normal",ja:"基本状態"}),l=apn.CExe.GL({ko:"버튼 상태 표시를 위한 이미지",en:"Image for each states",ja:"ボタンの状態を表示するための画像"}),s=r,p=o;if(2==e.wgtGetProperty(t,"btnV"))var g=apn.CExe.GL({ko:"버튼 상태 표시를 위한 텍스트/테두리 색상",en:"Text/border color for each states",ja:"ボタンの状態を表示するためのテキスト/枠線の色"});else var g=apn.CExe.GL({ko:"버튼 상태 표시를 위한 텍스트 색상",en:"Text color for each states",ja:"ボタンの状態を表示するためのテキストの色"});this.I_edtOnConfig_title&&this.I_edtOnConfig_title(e,t,a,"normal")&&(s=this.I_edtOnConfig_title(e,t,a,"normal")),this.I_edtOnConfig_title&&this.I_edtOnConfig_title(e,t,a,"disabled")&&(p=this.I_edtOnConfig_title(e,t,a,"disabled")),i.eduLib&&delete i.eduLib,i.innerHTML="";var u="text"==e.wgtGetProperty(t,"btnType"),c=!!e.wgtGetProperty(t,"apxText");if("tab"==d)s==r&&(s=apn.CExe.GL({ko:"미선택 상태",en:"Unselected",ja:"未選択の状態"})),p==o&&(p=apn.CExe.GL({ko:"선택 상태",en:"Selected",ja:"選択状態"})),u||(eduLib.edtInputAdd(e,i,{type:"title",title:l}),eduLib.edtInputAdd(e,i,{type:"image",title:s+"",value:n.images,key:"normal",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Hover",value:n.images,key:"hover",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:p+"",value:n.images,key:"disabled",join:!0})),n.clr&&(c||u)&&(n.clr.down&&(n.clr.down=null),eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:g}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:p,value:n.clr,key:"disabled",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Hover",value:n.clr,key:"hover",join:!0}));else if("toggle"==d)p==o&&(p="Selected"),u||(eduLib.edtInputAdd(e,i,{type:"title",title:l}),eduLib.edtInputAdd(e,i,{type:"image",title:p+"",value:n.images,key:"disabled",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:p+" Hover",value:n.images,key:"disabledHover",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:p+" Pressed",value:n.images,key:"disabledDown",join:!0}),eduLib.edtInputAdd(e,i,{type:"space",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+"",value:n.images,key:"normal",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Hover",value:n.images,key:"hover",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Pressed",value:n.images,key:"down",join:!0})),n.clr&&(c||u)&&(eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:g}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:p,value:n.clr,key:"disabled",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:p+" Hover",value:n.clr,key:"disabledHover",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:p+" Pressed",value:n.clr,key:"disabledDown",join:!0}),eduLib.edtInputAdd(e,i,{type:"space",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Hover",value:n.clr,key:"hover",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Pressed",value:n.clr,key:"down",join:!0}));else if("check"==d){s=apn.CExe.GL({ko:"미선택 상태",en:"Unchecked",ja:"未選択の状態"});var m=apn.CExe.GL({ko:"선택 상태",en:"Checked",ja:"選択状態"});u||(eduLib.edtInputAdd(e,i,{type:"title",title:l}),eduLib.edtInputAdd(e,i,{type:"image",title:m+"",value:n.images,key:"checked",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:m+" Hover",value:n.images,key:"checkedH",join:!0}),eduLib.edtInputAdd(e,i,{type:"space",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+"",value:n.images,key:"normal",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Hover",value:n.images,key:"hover",join:!0})),n.clr&&(c||u)&&(eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:g}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:m,value:n.clr,key:"checked",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:m+" Hover",value:n.clr,key:"checkedH",join:!0}),eduLib.edtInputAdd(e,i,{type:"space",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Hover",value:n.clr,key:"hover",join:!0}))}else u||(eduLib.edtInputAdd(e,i,{type:"title",title:l}),eduLib.edtInputAdd(e,i,{type:"image",title:s+"",value:n.images,key:"normal",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Hover",value:n.images,key:"hover",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:s+" Pressed",value:n.images,key:"down",join:!0}),"simple"!=d&&(eduLib.edtInputAdd(e,i,{type:"space",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:p,value:n.images,key:"disabled",join:!0}))),n.clr&&(c||u)&&(eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:g}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Hover",value:n.clr,key:"hover",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:s+" Pressed",value:n.clr,key:"down",join:!0}),"simple"!=d&&eduLib.edtInputAdd(e,i,{type:"color",askUse:!0,title:p,value:n.clr,key:"disabled",join:!0})),eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:apn.CExe.GL({ko:"버튼간 Hover/Pressed 상태 동기화",en:"Synchronize Hover/Pressed status with buttons",ja:"ボタン間Hover/Pressed状態を同期"})}),eduLib.edtInputAdd(e,i,{type:"text",title:apn.CExe.GL({ko:"그룹 지정",en:"Group",ja:"グループ指定"}),value:n,key:"hvrSync",comment:apn.CExe.GL({ko:"(편집자가 할당한 그룹ID)",en:"(Unique group ID assigned by user(editor))",ja:"（編集者が割り当てたグループID）"}),join:!0});eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:apn.CExe.GL({ko:"도움말(툴팁)",en:"Tooltip",ja:"ヘルプ（ツールチップ）"})}),eduLib.edtInputAdd(e,i,{type:"text",title:apn.CExe.GL({ko:"메시지",en:"Message",ja:"メッセージ"}),value:n,key:"ttip",join:!0})},xa.edtOnSetState=function(e,t,a){var i=e.wgtGetProperty(t,"cfg");i.images[a].mediaID?e.wgtSetProperty(t,"apxMediaID",i.images[a].mediaID,e.wgtGetProperty(t,"autoKeepSize")):e.wgtSetProperty(t,"apxMediaID",null)},xa.edtOnBuildState=function(e,t,a,i){var d,n=e.pages[a].objects[t].create.data;n&&n.properties&&n.properties.attrs&&(d=n.properties.attrs.selectType),"tab"==d||"toggle"==d?(i.disabled="Selected",i.normal="Unselected"):"check"==d?(i.checked="Checked",i.normal="Unchecked"):(i.normal="Normal",i.disabled="Disabled")},xa.pubOnGetHTML=function(e,t,a,i){var d=apn.IWidget.htmlRender(this,e,t,a),n="<div";d.css+="overflow:hidden;",d.style.mediaID&&(d.css+="background-size:100% 100%;background-repeat:no-repeat;background-image: url("+apn.Project.mediaResolve(e,d.style.mediaID,!1,!0)+");");var o="",r=e.pages[t].objects[a].create.data.properties.attrs;return r.ttip&&(o+=' title="'+apn.IWidget.exeFormatText(r.ttip,{xml:!0,noTag:!0})+'"'),n+=' style="'+d.css+'"'+o,n+=' class="apxWgt1'+(i&&i.addCls?" "+i.addCls:"")+'"',n+=i&&i.noId?">":' data-apx-id="'+a+'">',n+="</div>"},uxWgtBtnImage=xa;
