var xa={APX_NO_POINTER_EV:!0};xa.styleMap={title:!0},xa.exeItrNoResize=!0,xa.exeItrNoZoom=!0,xa.exeItrNoMove=!0,xa.editor={},xa.editor.states={on:"On",off:"Off"},xa.editor.properties={Interval:{title:"Interval[ms]",input:null,type:"number"},Offset:{title:"Offset[±ms]",input:null,type:"number"},noST:{title:"FireOnStart",input:[{title:"Yes",value:""},{title:"No",value:"Y"}]},apxBackgroundTick:{title:"Daemon",input:[{title:"On",value:"Y"},{title:"Off",value:""}]},apxAllowBubble:{title:"Bubbling",input:[{title:"Yes",value:"Y"},{title:"No",value:""}]}},xa.apnCImage={url:"DB/ux/imgs/wgts/edit/timer_on.png"},xa.properties={},xa.properties.state="off",xa.properties.attrs={Interval:1e3,Offset:0,apxBackgroundTick:"",noST:"",apxAllowBubble:""},xa.MIN=25,xa.createAsCanvasObject=function(t,e,a,r,n){return apn.IWidget.createCanvasObject(t,this,"apn.CImage",bx.CCanvasWnd.SHAPE_RECT,e,a,r,n,void 0,apn.CEditorS.NO_RESIZE)},xa.exeCreateTag=function(t,e,a,r,n,i){var o=document.body.$TAG("div",{style:"position:absolute;overflow:hidden;"});return o.apnCur={},i&&e.wgtHide&&e.wgtHide(i),o},xa.exeRenderTag=function(t,e,a,r,n,i){return a},xa.exeOnLoad=function(t,e){var a=bx.$checkNaN(parseInt(t.wgtGetProperty(e,"Offset"))),r=bx.$checkNaN(parseInt(t.wgtGetProperty(e,"Interval")));r<uxWgtTimer.MIN&&(r=uxWgtTimer.MIN);var n=t.wgtTag(e);n._interval=r,n._offset=a},xa.exeOnStart=xa.exeOnResume=function(t,e){var a=t.wgtTag(e);a.__state="on"==t.wgtGetProperty(e,"apxState"),a._tm=0},xa.exeOnTick=function(t,e,a){var r=t.wgtTag(e);if(r.__state){if(0===r._tm&&"Y"==t.wgtGetProperty(e,"noST"))return void(r._tm=a+r._interval);(0===r._tm||r._tm<=a)&&(t.fireEvent("timer",void 0,e,"Y"==t.wgtGetProperty(e,"apxBackgroundTick")),r._tm=a+Math.max(uxWgtTimer.MIN,r._interval+Math.floor(r._offset*(Math.random()-.5)*2)))}},xa.exeSetState=function(t,e,a){e.__state="on"==a,e._tm=0},xa.edtOnSetState=function(t,e,a){var r=t.wgtGetProperty(e,"Interval");r=bx.$checkNaN(parseInt(r)),r<uxWgtTimer.MIN&&(r=uxWgtTimer.MIN,t.wgtSetProperty(e,"Interval",r)),t.wgtSetProperty(e,"URL","DB/ux/imgs/wgts/edit/timer_"+a+".png"),t.setMediaToObject(e,"DB/ux/imgs/wgts/edit/timer_"+a+".png")},xa.edtOnBuildEvent=function(t,e,a,r){r.timer={value:"timer",title:apn.P.eventTitle.timer}},uxWgtTimer=xa;
var xa={};xa.styleMap={title:!0,borderRadiusTopLeft:!0,borderRadiusTopRight:!0,borderRadiusBottomLeft:!0,borderRadiusBottomRight:!0},xa.exeItrNoMove=!0,xa.editor={},xa.editor.iconThumb="DB/EDU/imgs/wgts/thumbs/spriteAnimation.png",xa.editor.states={on:"On",off:"Off",effect:"Effect",effectS:"EffectAndSound",effect7:"Effect7",effect7S:"EffectAndSound7"},xa.scriptInfo={wgtRun:{effect:{param:"{point:Array|{x:Number,y:Number}, sound:Boolean|undefined, interval:Number|undefined, use:1-based Number|undefined}",help:{ko:"'point'에 해당하는 위치에 효과를 표시합니다. Array이면, 연쇄적으로 효과를 표시합니다. 이때 'interval'은 Milisecond로 지정될 수 있으며 효과간 간격으로 사용됩니다. 'sound'가 true이면 등록된 효과음을 출력합니다. 'use'는 사용할 Effect를 지정합니다.",en:"Displays effects on positions of 'point'. If 'point' is Array, chained effects will be animated. 'interval' is an interval time(milisecond) between effects if chained. If 'sound' is ture, the registered sound will be played. If there are multiple effects, you can select by 'use'."}}}},xa.properties={},xa.properties.state="on",xa.properties.attrs={cfg:{type:"snow",imgs:[{img:{mediaID:void 0}}],opts:{},uSnd:{mediaID:void 0},ver:"",v2:[{type:"sprinkle",i1:{mediaID:void 0},i2:{mediaID:void 0},i3:{mediaID:void 0},i4:{mediaID:void 0},i5:{mediaID:void 0},s1:{mediaID:void 0}}]}},xa.createAsCanvasObject=apn.widgets["apn.wgt.itrAreaRect"].createAsCanvasObject,xa.exeCreateTag=apn.widgets["apn.wgt.rect"].exeCreateTag,xa.exeRenderTag=apn.widgets["apn.wgt.rect"].exeRenderTag,xa.exeSetState=function(e,t,a){"off"==a?t.__off=!0:"on"==a?t.__off=!1:!t.ctx||"effect"!=a&&"effectS"!=a?!t.ctx||"effect7"!=a&&"effect7S"!=a?"U"==a[0]&&t.ctx&&2==t.ctx.cfg.ver&&(t.ctx.v2cur=a.substring(1)):t.ctx.poolReady?this._effect7(e,t,"effect7S"==a):t.ctx.bWorkDelayed7="effect7S"==a?1:2:t.ctx.lastPos.length&&(t.ctx.poolReady?this._effect(e,t,t.ctx.lastPos[t.ctx.lastPos.length-1].x,t.ctx.lastPos[t.ctx.lastPos.length-1].y,"effectS"==a):t.ctx.bWorkDelayed="effectS"==a?1:2)},xa.exeOnLoad=function(e,t){function a(t){if(t&&i&&i.ctx){if(i.ctx.poolReady=!0,2==r.ver)if(i.ctx.v2cur&&i.ctx.v2imgs[i.ctx.v2cur]);else for(var a in i.ctx.v2imgs){i.ctx.v2cur=a;break}i.ctx.bWorkDelayed&&(o._effect(e,i,i.ctx.lastPos[i.ctx.lastPos.length-1].x,i.ctx.lastPos[i.ctx.lastPos.length-1].y,1==i.ctx.bWorkDelayed),i.ctx.bWorkDelayed=!1),i.ctx.bWorkDelayed7&&(o._effect7(e,i,1==i.ctx.bWorkDelayed7),i.ctx.bWorkDelayed7=!1),i.ctx.bWorkDelayedRun&&(o.chainEffect(e,i,i.ctx.bWorkDelayedRun.pts,i.ctx.bWorkDelayedRun.opts),i.ctx.bWorkDelayedRun=!1)}}function n(t){var n,o=0,r=0;i.ctx.v2imgs=i.ctx.v2imgs||{};for(var c=0;c<t.length;c++)n=new Image,n.__group=t[c].group,n.onload=function(){var n=i.ctx.v2imgs[this.__group]=i.ctx.v2imgs[this.__group]||[];(void 0===n.__maxImgW||n.__maxImgW<Math.ceil(this.width*(1/e.getZoomX())))&&(n.__maxImgW=Math.ceil(this.width*(1/e.getZoomX()))),(void 0===n.__maxImgH||n.__maxImgH<Math.ceil(this.height*(1/e.getZoomY())))&&(n.__maxImgH=Math.ceil(this.height*(1/e.getZoomY()))),n.push(this),r++,o+r==t.length&&a(r)},n.onerror=n.onabort=function(){o++,o+r==t.length&&a(r)},n.src=t[c].url}var o=this,i=e.wgtTag(t);e.tagPassPointerEvent(i,!0,!0),i.style.overflow="visible",delete i.textTag;var r=e.wgtGetProperty(t,"cfg"),c=[];if(2==r.ver)for(var d=0;d<r.v2.length;d++)for(var p=1;p<=5;p++)r.v2[d]["i"+p].mediaID&&c.push({group:d,url:e.mediaURL(r.v2[d]["i"+p].mediaID)});else for(var d=0;d<r.imgs.length;d++)r.imgs[d].img.mediaID&&c.push(e.mediaURL(r.imgs[d].img.mediaID));if(!c.length)return void e.log(t,"Image for animation is not set.");i.ctx={cfg:r},2==i.ctx.cfg.ver?(n(c),i.ctx.apnx=new apnx2(i,parseInt(i.style.width),parseInt(i.style.height),1/e.getZoomX(),1/e.getZoomY())):(i.ctx.pool=new apnx.CPool(i,c,35,1/e.getZoomX(),a),e.wgtSetProperty(t,"apxDisabledTick",!0)),i.ctx.effs={snow:{module:"fall",count:11,param:{}},acorn:{module:"fall",count:15,param:{time:.8,timingFall:"ease-in",timingCast1:"ease-out",timingCast2:"ease-out"}},bubble:{module:"bubble",count:11},sprinkle:{module:"sprinkle",count:19},spiral:{module:"spiral",count:17},spiralFly:{module:"spiral",count:17,param:{fly:!0}}},i.ctx.lastPos=[],"snow"==r.type&&(i.ctx.effs.snow.param.wind=bx.$checkNaN(parseInt(r.opts.param)));var o=this;i.apxOnEvent=function(e,t,a,n,r,c){var d="click";apn.dbUI&&apn.dbUI.system&&1==apn.dbUI.system.exeEventStart&&(e.viewer.o.CExeBookCore&&"Y"!=e.viewer.o.CExeBookCore.noDrag||(d="tapStart"));var p=apn.Project.getLayout(e.project).property.CExe;p&&p.event&&"T"==p.event.TS1&&(d="tapStart"),"click"!=t&&"tapStart"!=t||(r/=e.getZoomX(),c/=e.getZoomY(),i.ctx.lastPos.push({x:r,y:c})),t==d&&(i.__off||o._effect(e,i,r,c,!0))}},xa.exePropSet=function(e,t,a,n,o){if("effect"==a){if(o)return!0;if(n&&n.point){var i,r=e.wgtTag(t),c=e.screen.objects[t].create.data.properties.attrs.cfg,d=[],p=!1;if(i=parseInt(n.use)){if(i--,2!=c.ver||!c.v2[i]||!r.ctx.v2imgs[i])return;r.ctx.v2cur=i}if(n.point instanceof Array)for(var l=0;l<n.point.length;l++)d.push({x:Math.round(n.point[l].x*(1/e.getZoomY())),y:Math.round(n.point[l].y*(1/e.getZoomY()))});else n.point instanceof Object&&void 0!==n.point.x&&void 0!==n.point.y&&(d.push({x:Math.round(n.point.x*(1/e.getZoomY())),y:Math.round(n.point.y*(1/e.getZoomY()))}),p=!0);d.length&&(r.ctx&&r.ctx.poolReady?this.chainEffect(e,r,d,{check:!0,sound:n.sound,interval:n.interval,full:p}):r.ctx.bWorkDelayedRun={pts:d,opts:{check:!0,sound:n.sound,interval:n.interval,full:p}})}else e.log(t,"Invalid parameter for Widget:run('effect',{...}).")}},xa.exeOnTick=function(e,t,a){var n=e.wgtTag(t);n.ctx&&n.ctx.poolReady&&n.ctx.apnx&&n.ctx.apnx.count&&n.ctx.apnx.clear()},xa.chainEffect=function(e,t,a,n){function o(){if(v<g){m=!(!n||!n.sound)&&(!(void 0!==n.interval&&n.interval<200)||0==v);var a=0;n&&n.full||(a=bx.HCL.DV.isMobile()?13:25,n&&void 0!==n.interval&&n.interval<10&&(a=Math.min(a,Math.ceil(250/g)))),h=y._effect(e,t,i[v].x,i[v].y,m,{count:a}),void 0!==h&&(v++,e.setTimeout(o,n&&void 0!==n.interval?n.interval:h/2))}}if(t.ctx&&t.ctx.poolReady){var i=[];if(n&&n.check&&a.length>1){if(t.ctx.pool)var r=Math.max(t.ctx.pool.maxSize.w,t.ctx.pool.maxSize.h);else var r=Math.max(t.ctx.v2imgs[t.ctx.v2cur].__maxImgW,t.ctx.v2imgs[t.ctx.v2cur].__maxImgH);r*=2.5;var c,d,p=0;i.push(a[0]);for(var l=1;l<a.length;l++){if(d=Math.sqrt(Math.pow(a[l-1].x-a[l].x,2)+Math.pow(a[l-1].y-a[l].y,2)),c=Math.floor(d/r))for(var s,u,f,x=0;x<c;x++)s=(Math.atan2(a[l].x-a[l-1].x,a[l-1].y-a[l].y)+2*Math.PI)%(2*Math.PI),u=Math.sin(s)*r*(x+1),f=-Math.cos(s)*r*(x+1),i.push({x:a[l-1].x+u,y:a[l-1].y+f});p+=d-r*c,l<a.length-1&&p>r&&(p=0,i.push(a[l]))}i.push(a[a.length-1])}else 1==a.length&&i.push(a[0]);var m,g=i.length,v=0,h=0;n&&void 0!==n.interval&&(n.interval=bx.$checkNaN(parseInt(n.interval)),n.interval*=1/e.getZoomX());var y=this;o()}},xa._effCount={bubble:{m:20,w:35},sprinkle:{m:25,w:50},spiral:{m:20,w:35}},xa._effect=function(e,t,a,n,o,i){if(t.ctx&&t.ctx.poolReady){var r=t.ctx.cfg;if(2==r.ver){o&&r.v2[t.ctx.v2cur].s1&&r.v2[t.ctx.v2cur].s1.mediaID&&e.playAudio("edu.wgt.magicTouch."+t.ctx.v2cur,r.v2[t.ctx.v2cur].s1.mediaID);var c,d=r.v2[t.ctx.v2cur].type;return c=bx.HCL.DV.isMobile()?i&&i.count?i.count:this._effCount[d].m:i&&i.count?i.count:this._effCount[d].w,t.ctx.apnx[d](t.ctx.v2imgs[t.ctx.v2cur],c,i&&i.count?.75:1,{x:a-(bx.HCL.getElementX2(t)-bx.HCL.getElementX2(e.tag)),y:n-(bx.HCL.getElementY2(t)-bx.HCL.getElementY2(e.tag))})}return o&&r.uSnd&&r.uSnd.mediaID&&e.playAudio("edu.wgt.magicTouch",r.uSnd.mediaID),apnx.aniEffect[t.ctx.effs[r.type].module](e,t.ctx.pool,!0,{x:a-(bx.HCL.getElementX2(t)-bx.HCL.getElementX2(e.tag)),y:n-(bx.HCL.getElementY2(t)-bx.HCL.getElementY2(e.tag)),count:t.ctx.effs[r.type].count,param:t.ctx.effs[r.type].param})}},xa._effect7=function(e,t,a){if(t.ctx&&t.ctx.poolReady){for(var n=[],o=0;o<Math.min(t.ctx.lastPos.length,7);o++)n.push(t.ctx.lastPos[o]);if(n.length<7){var i=parseInt(t.style.width),r=parseInt(t.style.height),c=7-n.length,d=n[0]?n[0].x:Math.round(i/2),p=n[0]?n[0].y:Math.round(r/2),l=Math.min(Math.min(d,i-d),i/4),s=Math.min(Math.min(p,r-p),r/4);for(o=0;o<c;o++)n.push({x:Math.round(d+(Math.random()-.5)*l),y:Math.round(p+(Math.random()-.5)*s)})}this.chainEffect(e,t,n,{sound:a,full:!0})}},xa.pubOnGetPrerequisite=function(e,t,a){return[{url:"wgts/apnx-ani-1.0.js",type:"text/javascript"}]},xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,i),void 0===p.uSnd.mediaID&&delete p.uSnd,e.wgtSetProperty(t,"cfg",p)}function n(){"snow"==this.value?(eduLib.edtInputShow(e,i,"paramWind",!0),c=!0):(eduLib.edtInputShow(e,i,"paramWind",!1),c=!1),d&&eduLib.edtInputShow(e,i,"paramWind",!1)}function o(t){2==t?(eduLib.edtInputShow(e,i,"v2",!0),eduLib.edtInputShow(e,i,"v1",!1),eduLib.edtInputShow(e,i,"paramWind",!1),d=!0):(eduLib.edtInputShow(e,i,"v1",!0),eduLib.edtInputShow(e,i,"v2",!1),eduLib.edtInputShow(e,i,"paramWind",c),d=!1)}var i,r,c,d,p=e.wgtGetProperty(t,"cfg");p.opts.param=p.opts.param||"",p.uSnd=p.uSnd||{mediaID:void 0},p.v2&&(r=!0,d=!0);var l={title:apn.CExe.GL({ko:"풍선/거품",en:"Bubble/Balloon"}),value:"bubble"},s={title:apn.CExe.GL({ko:"불꽃놀이/뿌리기",en:"Sprinkle/Firework"}),value:"sprinkle"},u={title:apn.CExe.GL({ko:"회오리",en:"Spiral"}),value:"spiral"};if(i=e.dlgDoModal(900,Math.ceil(.7*bx.UX.height),a)){i.style.padding="12px",i.style.boxSizing="border-box";var f=[{title:apn.CExe.GL({ko:"도토리",en:"Acorn"}),value:"acorn"},l,{title:apn.CExe.GL({ko:"눈/꽃",en:"Snow/Flower"}),value:"snow"},u,{title:apn.CExe.GL({ko:"흩어지는 회오리",en:"Spiral away"}),value:"spiralFly"},s];r&&(eduLib.edtInputAdd(e,i,{type:"select",title:apn.CExe.GL({ko:"애니메이션 성능",en:"Animation performance"})+" (m)",options:[{title:apn.CExe.GL({ko:"저성능 저메모리 사용 방식",en:"Low performance and low memory consumption"}),value:""},{title:apn.CExe.GL({ko:"고성능 고메모리 사용 방식",en:"High performance but high memory consumption"}),value:"2"}],key:"ver",value:p,onchange:o,join:!0}),eduLib.edtInputAdd(e,i,{type:"space"})),eduLib.edtInputAdd(e,i,{type:"title",title:apn.CExe.GL({ko:"터치 효과",en:"Touch effect"}),join:!0}),eduLib.edtInputAdd(e,i,{id:"v2",type:"table",value:p.v2,options:{th:[apn.CExe.GL({ko:"효과",en:"Effect"})+" (m)",apn.CExe.GL({ko:"이미지 1",en:"Image 1"})+" (m)",apn.CExe.GL({ko:"이미지 2",en:"Image 2"}),apn.CExe.GL({ko:"이미지 3",en:"Image 3"}),apn.CExe.GL({ko:"이미지 4",en:"Image 4"}),apn.CExe.GL({ko:"이미지 5",en:"Image 5"}),apn.CExe.GL({ko:"효과음",en:"Sound effect"})],add:!0,remove:!0,order:!0},td:[{type:"select",key:"type",options:[l,u,s]},{type:"image",key:"i1",width:"80px"},{type:"image",key:"i2",width:"80px"},{type:"image",key:"i3",width:"80px"},{type:"image",key:"i4",width:"80px"},{type:"image",key:"i5",width:"80px"},{type:"audio",key:"s1",width:"180px"}],join:!0}),eduLib.edtInputAdd(e,i,{id:"v1",type:"select",title:apn.CExe.GL({ko:"종류",en:"Type"})+" (m)",options:f,key:"type",value:p,onchange:n,join:!0}),eduLib.edtInputAdd(e,i,{id:"paramWind",type:"select",title:apn.CExe.GL({ko:"바람",en:"Wind"}),options:[{title:apn.CExe.GL({ko:"[없음]",en:"[None]"}),value:""},{title:apn.CExe.GL({ko:"오른쪽으로 약하게",en:"Breeze to right"}),value:"1"},{title:apn.CExe.GL({ko:"왼쪽으로 약하게",en:"Breeze to left"}),value:"-1"},{title:apn.CExe.GL({ko:"오른쪽으로",en:"Wind to right"}),value:"2"},{title:apn.CExe.GL({ko:"왼쪽으로",en:"Wind to left"}),value:"-2"}],value:p.opts,key:"param",join:!0}),eduLib.edtInputAdd(e,i,{id:"v1",type:"table",value:p.imgs,options:{th:[apn.CExe.GL({ko:"이미지",en:"Images"})+" (m)"],add:!0,remove:!0,noNumber:!0},td:[{type:"image",key:"img"}],join:!0}),eduLib.edtInputAdd(e,i,{id:"v1",type:"audio",title:apn.CExe.GL({ko:"효과음",en:"Sound effect"}),value:p,key:"uSnd",join:!0})}},xa.edtOnCheckEdited=function(e,t){for(var a=e.wgtGetProperty(t,"cfg"),n=0;n<a.imgs.length;n++)if(a.imgs[n]&&a.imgs[n].img&&a.imgs[n].img.mediaID)return!0;return!1},xa.edtOnBuildState=function(e,t,a,n){var o=e.pages[a].objects[t].create.data.properties.attrs.cfg;if(n.on="On",n.off="Off",n.effect="Effect",n.effectS="EffectAndSound",n.effect7="Effect7",n.effect7S="EffectAndSound7",2==o.ver&&o.v2)for(var i=0;i<o.v2.length;i++)(o.v2[i].i1.mediaID||o.v2[i].i2.mediaID||o.v2[i].i3.mediaID||o.v2[i].i4.mediaID||o.v2[i].i5.mediaID)&&(n["U"+i]="Use "+(i+1))},eduWgtMagicTouch=xa;
var xa;xa=apn.inheritWidget(apn.widgets["apn.wgt.image"]),xa.editor={},xa.editor.iconThumb="DB/EDU/imgs/wgts/thumbs/spriteAnimation.png",xa.editor.states={play:"Play",loop:"Loop",stop:"Stop"},xa.properties.state="stop",xa.properties.attrs={apxAnimate:!0,cfg:{frames:[{sprite:{mediaID:void 0},duration:42}],idStep:""}},xa.onEdit=void 0,xa.exeCreateTag=apn.widgets["apn.wgt.rect"].exeCreateTag,xa.exeRenderTag=apn.widgets["apn.wgt.rect"].exeRenderTag,xa.exeAssetLoad=void 0,xa.exeAssetPreload=function(e,t,a){function i(i,c,s){a(),uxWgtImgSprite._frame(e,n,n.ctx.cur),r.exeOnCheckContentLoad&&e.fireEvent("contentLoad","i",t,!0,e.project.property.allowImmediateContentLoad)}var r=this,n=e.wgtTag(t);n.ctx={},n.ctx.frames=[],n.ctx.cur=0,n.ctx.action=0,n.ctx.lastTickTime=0;for(var c=e.wgtGetProperty(t,"cfg"),s=0,o={},d=0;d<c.frames.length;d++)buf=bx.$cloneObject({},c.frames[d]),buf.duration=bx.$checkNaN(parseInt(buf.duration)),buf.sprite.mediaID&&buf.duration&&(o["sp"+d]={url:e.mediaURL(c.frames[d].sprite.mediaID)},s++,buf.img=o["sp"+d],n.ctx.frames.push(buf));s?(new apn.CRscLoader).load(e.project,o,i):a()},xa.exeOnLoad=function(e,t){function a(a,n){if(a==r.idStep&&n){if(!i.ctx.frames[n.current])return void e.log(t,"Invalid frame was requested to display by step interface. FrameIndex="+n.current);i.ctx.cur!=n.current&&n.current<i.ctx.frames.length&&(i.ctx.cur=n.current,uxWgtImgSprite._frame(e,i,i.ctx.cur))}}var i=e.wgtTag(t),r=e.wgtGetProperty(t,"cfg");bx.HCL.DV.isIE()&&bx.HCL.DV.isIE()<9?i.img=i.$TAG("img",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}):(i.canvas=i.$TAG("canvas",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}),i.canvas.width=parseInt(i.style.width),i.canvas.height=parseInt(i.style.height)),uxWgtImgSprite._frame(e,i,i.ctx.cur),r.idStep&&e.wgtListenProperty(t,"apxStep",a)},xa.exeOnCheckContentLoad=function(e,t,a){return{i:"Image"}},xa.exeSetState=function(e,t,a,i){"stop"==a?this._stop(e,t,!0):"play"==a?(t.ctx.action=1,t.ctx.lastTickTime=0,e.fireEvent("animation","Start",e.wgtId(t))):"loop"==a&&(t.ctx.action=2,t.ctx.lastTickTime=0,e.fireEvent("animation","Start",e.wgtId(t)))},xa.exeOnTick=function(e,t,a){var i=e.wgtTag(t);if(i.ctx&&i.ctx.frames.length&&0!=i.ctx.action){i.ctx._onceStarted=!0;var r;0==i.ctx.lastTickTime?(i.ctx.cur=0,r=!0):i.ctx.lastTickTime<a&&(r=!0,2==i.ctx.action?i.ctx.cur=(i.ctx.cur+1)%i.ctx.frames.length:(i.ctx.cur++,i.ctx.cur==i.ctx.frames.length&&(i.ctx.cur=0,this._stop(e,i),r=!1))),r&&(i.ctx.lastTickTime=a+parseInt(i.ctx.frames[i.ctx.cur].duration),uxWgtImgSprite._frame(e,i,i.ctx.cur))}},xa._frame=function(e,t,a){if(t.ctx.frames[a]&&t.ctx.frames[a].img.image)if(t.canvas){var i=t.canvas.getContext("2d");i.clearRect(0,0,i.canvas.width,i.canvas.height),i.drawImage(t.ctx.frames[a].img.image,0,0,i.canvas.width,i.canvas.height)}else t.img&&(t.img.src=t.ctx.frames[a].img.url)},xa._stop=function(e,t,a){t.ctx.action=0,t.ctx.lastTickTime=0,a&&t.ctx.frames[0]&&t.ctx.frames[0].sprite.mediaID&&(t.ctx.cur=0,uxWgtImgSprite._frame(e,t,0)),t.ctx._onceStarted&&e.fireEvent("animation","End",e.wgtId(t))},xa.edtSetupStep=function(e,t,a,i){var r=e.getScreenData(),n=[{title:apn.CExe.GL({ko:"[없음]",en:"[None]",ja:"[なし]"}),value:""}];for(var c in r.objects)r.objects[c].create&&r.objects[c].create.data&&r.objects[c].create.data.properties&&r.objects[c].create.data.properties.attrs&&r.objects[c].create.data.properties.attrs.apxStep&&n.push({value:c,title:e.itrGetObjectTitle(c)});eduLib.edtInputAdd(e,a,{type:"select",options:n,title:apn.CExe.GL({ko:"연동할 위젯",en:"Widget to interface with",ja:"連動するウィジェット"}),key:"idStep",value:i,join:!0})},xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,r.tagTab1),eduLib.edtInputApplyAll(e,r.tagTab2),n.frames[0].sprite.mediaID&&e.wgtSetProperty(t,"apxMediaID",n.frames[0].sprite.mediaID),e.wgtSetProperty(t,"cfg",n),e.wgtRefreshUI(t)}function i(){for(var e in c)c[e]&&(this.id==e?(r[e].style.display="block",r.tagTab.$$(e).style.borderStyle="solid solid none solid"):(r[e].style.display="none",r.tagTab.$$(e).style.borderStyle="none none solid none"));uxWgtImgSprite._uiLastSetupTab=this.id}var r,n=e.wgtGetProperty(t,"cfg"),c={tagTab1:!0,tagTab2:!0};if(r=e.dlgDoModal(600,Math.ceil(.9*bx.UX.height),a)){var s=apn.CExe.CSS_SETUP_PANE+"height:"+(r.clientHeight-40)+"px";r.tagTab=r.$TAG("div",{style:"position:relative;font-weight:bold;width:100%;height:26px;padding-bottom:14px;"}),r.tagTab.innerHTML='<span id="tagTab1" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스프라이트",en:"Sprite Sheet",ja:"スプライト"})+'</span><span id="tagTab2" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스텝 연동",en:"Step Interface",ja:"ステップ連動"})+"</span>"+apn.CExe.CSS_SETUP_TAB_END,r.tagTab.$$("tagTab1").onclick=r.tagTab.$$("tagTab2").onclick=i,r.tagTab1=r.$TAG("div",{style:s}),r.tagTab2=r.$TAG("div",{style:s}),eduLib.edtInputAdd(e,r.tagTab1,{type:"table",value:n.frames,options:{th:[apn.CExe.GL({ko:"프레임 이미지",en:"Frame image",ja:"フレーム画像"}),apn.CExe.GL({ko:"프레임 시간",en:"Duration",ja:"フレーム時間"})+"[ms]"],add:!0,remove:!0,order:!0},td:[{type:"image",key:"sprite"},{type:"text",key:"duration",width:"110px"}],join:!0}),eduLib.edtInputAdd(e,r.tagTab1,{type:"message",value:"※ "+apn.CExe.GL({ko:"과도한 이미지의 사용은 HTML5 컨텐츠의 성능을 크게 저하시킵니다. 그러한 경우, Video로 제작하거나 Scene Animation으로 편집하는 것이 좋습니다.",en:"Excessive image resources will slow down HTML5 contents. In that case, video or Scene Animation is better.",ja:"過度な画像の使用は、HTML5コンテンツのパフォーマンスを大幅に低下させます。その場合、Videoでの製作や、Scene Animationでの編集をお勧めします。"}),join:!0}),this.edtSetupStep(e,t,r.tagTab2,n),void 0!==uxWgtImgSprite._uiLastSetupTab&&r.tagTab.$$(uxWgtImgSprite._uiLastSetupTab)?r.tagTab.$$(uxWgtImgSprite._uiLastSetupTab).onclick():r.tagTab.$$("tagTab1").onclick(),r.tagTab.$$("tagBlank").style.width=r.clientWidth-r.tagTab.$$("tagBlank").offsetLeft-1+"px"}},xa.edtOnRemapObjectID=function(e,t,a){if(t&&t.properties&&t.properties.attrs&&t.properties.attrs.cfg){var i=t.properties.attrs.cfg;i.idStep&&(a[i.idStep]?i.idStep=a[i.idStep]:e.getScreenData().objects[i.idStep]||(i.idStep=""))}},uxWgtImgSprite=xa,xa=apn.inheritWidget(uxWgtImgSprite),xa.properties.attrs.imgCropSprite=!0,xa.properties.attrs.ver=2,xa.properties.attrs.cfg={ty:"s",mr:0,s:{img:{mediaID:void 0},w:64,h:64,cnt:1,cols:0,x:0,y:0,tm:42},f:{file:{size:0,data:""},edt:{}},idStep:""},xa.scriptInfo={wgtData:{sheet:{help:"{type:'simple', data:{img:{mediaID:id}, w:Number, h:Number, cnt:Number, x:Number, y:Number, tm:Msec}\nSprite sheet data.",type:"so"}},wgtRun:{showFrame:{param:"1-based Number",help:{ko:"지정된 프레임을 표시합니다.",en:"Show the designated frame",ja:"指定されたフレームを表示します。"}}}},xa.exeCreateTag=apn.widgets["apn.wgt.rect"].exeCreateTag,xa.exeRenderTag=function(e,t,a,i,r,n){return apn.widgets["apn.wgt.rect"].exeRenderTag.call(this,e,t,a,i,r,n),a.tagOnPostResize=function(e,t){if(t.ctx.cellHolder){var a=e.wgtGetProperty(t.apnOID,"cfg"),i=1,r=parseInt(t.style.width)/(a.s.w*i),n=parseInt(t.style.height)/(a.s.h*i);r=parseInt(t.style.width)/a.s.w,n=parseInt(t.style.height)/a.s.h,t.ctx.cellHolder.$CSS({transform:"scale("+r*i+","+n*i+")",transformOrigin:"0px 0px"})}},a},xa.exeAssetPreload=function(e,t,a){function i(i,o,d){r.ctx.image=c.sp.image,s._loadSpriteSheet(e,t,n),a(),s.exeOnCheckContentLoad&&e.fireEvent("contentLoad","i",t,!0,e.project.property.allowImmediateContentLoad)}var r=e.wgtTag(t);r.ctx={},r.ctx.cur=0,r.ctx.action=0,r.ctx.lastTickTime=0,r.ctx.frames=[];var n=e.wgtGetProperty(t,"cfg");if(n.s.img.mediaID){var c={},s=this;c.sp={url:e.mediaURL(n.s.img.mediaID)},(new apn.CRscLoader).load(e.project,c,i)}else a()},xa.exeOnCheckContentLoad=function(e,t,a){return{i:"Image"}},xa.exeOnLoad=function(e,t){function a(a,i){function n(a,n,o){a==n&&(r.ctx.image=s.sp.image,i.data.h=s.sht.image.height,i.data.w=Math.max(1,s.sht.image.width/i.data.cnt),c._loadSpriteSheet(e,t,{ty:"s",s:i.data}))}if(a==t&&i&&i.type&&i.data&&i.data.img&&i.data.img.mediaID&&i.data.cnt&&"simple"==i.type)if(i.data.w&&i.data.h)c._loadSpriteSheet(e,t,{ty:"s",s:i.data});else{var s={};s.sht={url:e.mediaURL(i.data.img.mediaID)},(new apn.CRscLoader).load(e.project,s,n)}}function i(a,i){if(a==n.idStep&&i){if(!r.ctx.frames[i.current])return void e.log(t,"Invalid frame was requested to display by step interface. FrameIndex="+i.current);r.ctx.cur!=i.current&&i.current<r.ctx.frames.length&&(r.ctx.cur=i.current,c._render(e,r,r.ctx.frames[r.ctx.cur]))}}var r=e.wgtTag(t),n=e.wgtGetProperty(t,"cfg"),c=this;if(e.wgtListenProperty(t,"sheet",a),n.idStep){var c=this;e.wgtListenProperty(t,"apxStep",i)}},xa._loadSpriteSheet=function(e,t,a){var i=e.wgtTag(t);if(i){if("s"==a.ty&&a.s.img.mediaID&&a.s.w&&a.s.h&&a.s.cnt&&a.s.tm)for(var r=a.s.cols||a.s.cnt,n=x=bx.$checkNaN(parseInt(a.s.x))||0,c=bx.$checkNaN(parseInt(a.s.y))||0,s=0;s<a.s.cnt;s++)i.ctx.frames[s]={x:x,y:c,w:a.s.w,h:a.s.h,offX:0,offY:0,tm:a.s.tm},x+=a.s.w,(s+1)%r==0&&(x=n,c+=a.s.h);else if("f"==a.ty&&a.f&&a.f.file&&a.f.file.data){try{var o=JSON.parse(a.f.file.data)}catch(a){e.log(t,"JSON file parsing error:"+a)}if(o&&o.frames)for(var s in o.frames)o.frames[s].frame&&i.ctx.frames.push({x:o.frames[s].frame.x,y:o.frames[s].frame.y,w:o.frames[s].frame.w,h:o.frames[s].frame.h,offX:o.frames[s].spriteSourceSize.x,offY:o.frames[s].spriteSourceSize.y,tm:a.s.tm})}if(i.ctx.useCanvas=!1,2!=e.wgtGetProperty(t,"ver")||bx.HCL.DV.isIE()&&bx.HCL.DV.isIE()<9||(i.ctx.useCanvas=!0),i.ctx.cellInfo=a,i.ctx.useCanvas){if(i.ctx.cell=i.$TAG("canvas",{style:"cursor:inherit;position:absolute;left:0px;top:0px;width:100%;height:100%;"}),i.ctx.cell.width=parseInt(i.style.width),i.ctx.cell.height=parseInt(i.style.height),i.ctx.cvsCtx=i.ctx.cell.getContext("2d"),a.mr&&(1==a.mr?(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateY(180deg)")):2==a.mr?(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateX(180deg)")):3==a.mr&&(i.ctx.cell.$CSS("transformOrigin","50% 50%"),i.ctx.cell.$CSS("transform","rotateX(180deg) rotateY(180deg)"))),i.ctx.frames.length){var d=0;void 0!==i.ctx._delayedFrame&&i.ctx._delayedFrame>=0&&i.ctx._delayedFrame<i.ctx.frames.length&&(d=i.ctx._delayedFrame,delete i.ctx._delayedFrame),this._render(e,i,i.ctx.frames[d])}}else if(a.mr?(i.ctx.cellHolderMr=i.ctx.cellHolderMr||i.$TAG("div",{style:"cursor:inherit;width:100%;height:100%;"}),i.ctx.cellHolder=i.ctx.cellHolder||i.ctx.cellHolderMr.$TAG("div"),1==a.mr?(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateY(180deg)")):2==a.mr?(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateX(180deg)")):3==a.mr&&(i.ctx.cellHolderMr.$CSS("transformOrigin","50% 50%"),i.ctx.cellHolderMr.$CSS("transform","rotateX(180deg) rotateY(180deg)"))):i.ctx.cellHolder=i.ctx.cellHolder||i.$TAG("div"),i.ctx.cellHolder.$A({style:"cursor:inherit;width:"+a.s.w+"px;height:"+a.s.h+"px"}),i.ctx.cell=i.ctx.cell||i.ctx.cellHolder.$TAG("div"),i.ctx.cell.$A({style:"cursor:inherit;position:absolute;left:0px;top:0px;width:"+a.s.w+"px;height:"+a.s.h+"px"}),i.ctx.frames.length){i.tagOnPostResize(e,i),i.ctx.cell.style.backgroundImage="url("+e.mediaURL(a.s.img.mediaID)+")",i.ctx.cell.style.backgroundRepeat="no-repeat";var d=0;void 0!==i.ctx._delayedFrame&&i.ctx._delayedFrame>=0&&i.ctx._delayedFrame<i.ctx.frames.length&&(d=i.ctx._delayedFrame,delete i.ctx._delayedFrame),this._render(e,i,i.ctx.frames[d])}}},xa.exeOnTick=function(e,t,a){var i=e.wgtTag(t);if(i.ctx.frames.length&&0!=i.ctx.action){i.ctx._onceStarted=!0;var r;0==i.ctx.lastTickTime?(i.ctx.cur=0,r=!0):i.ctx.lastTickTime<a&&(r=!0,2==i.ctx.action?i.ctx.cur=(i.ctx.cur+1)%i.ctx.frames.length:(i.ctx.cur++,i.ctx.cur==i.ctx.frames.length&&(i.ctx.cur=0,this._stop(e,i),r=!1))),r&&(i.ctx.lastTickTime=a+i.ctx.frames[i.ctx.cur].tm,this._render(e,i,i.ctx.frames[i.ctx.cur]))}},xa.exePropSet=function(e,t,a,i,r){if("showFrame"==a){if(r)return!0;var n=e.wgtTag(t);n.ctx&&(n.ctx.frames.length?i>0&&i<=n.ctx.frames.length?this._render(e,n,n.ctx.frames[i-1]):e.log(t,"Invalid frame was requested by Widget:run(). FrameIndex="+i):n.ctx._delayedFrame=i-1)}},xa._render=function(e,t,a){if(t.ctx.useCanvas)t.ctx.image&&(t.ctx.cvsCtx.clearRect(0,0,t.ctx.cell.width,t.ctx.cell.height),t.ctx.cvsCtx.drawImage(t.ctx.image,a.x,a.y,a.w,a.h,Math.round(a.offX*(1/e.getZoomX())),Math.round(a.offY*(1/e.getZoomY())),t.ctx.cell.width-Math.round(a.offX*(1/e.getZoomX())),t.ctx.cell.height-Math.round(a.offY*(1/e.getZoomY()))));else{var i=t.ctx.cell.style;i.left!=a.offX+"px"&&(i.left=a.offX+"px"),i.top!=a.offY+"px"&&(i.top=a.offY+"px"),i.width!=a.w+"px"&&(i.width=a.w+"px"),i.height!=a.h+"px"&&(i.height=a.h+"px"),i.backgroundPosition=-a.x+"px "+-a.y+"px"}},xa._stop=function(e,t,a){t.ctx.action=0,t.ctx.lastTickTime=0,a&&t.ctx.frames[0]&&this._render(e,t,t.ctx.frames[0]),t.ctx._onceStarted&&e.fireEvent("animation","End",e.wgtId(t))},xa.edtOnConfig=function(e,t){function a(){if(eduLib.edtInputApplyAll(e,c.tagTab1),eduLib.edtInputApplyAll(e,c.tagTab2),n.s.img.mediaID&&e.wgtSetProperty(t,"apxMediaID",n.s.img.mediaID),"f"==n.ty&&(n.f.edt.w=n.f.edt.h=0,n.f.file.data)){try{var a=JSON.parse(n.f.file.data)}catch(e){}if(a&&a.frames)for(var i in a.frames){n.f.edt.x=a.frames[i].frame.x,n.f.edt.y=a.frames[i].frame.y,n.f.edt.w=a.frames[i].frame.w,n.f.edt.h=a.frames[i].frame.h,n.f.edt.offX=a.frames[i].spriteSourceSize.x,n.f.edt.offY=a.frames[i].spriteSourceSize.y,n.s.w=a.frames[i].sourceSize.w,n.s.h=a.frames[i].sourceSize.h;break}}e.wgtSetProperty(t,"ver",2),e.wgtSetProperty(t,"cfg",n),e.wgtRefreshUI(t)}function i(){"s"==this.value?(eduLib.edtInputShow(e,c.tagTab1,"s",!0),eduLib.edtInputShow(e,c.tagTab1,"f",!1)):(eduLib.edtInputShow(e,c.tagTab1,"f",!0),eduLib.edtInputShow(e,c.tagTab1,"s",!1))}function r(){for(var e in s)s[e]&&(this.id==e?(c[e].style.display="block",c.tagTab.$$(e).style.borderStyle="solid solid none solid"):(c[e].style.display="none",c.tagTab.$$(e).style.borderStyle="none none solid none"));uxWgtShtSprite._uiLastSetupTab=this.id}var n=e.wgtGetProperty(t,"cfg");n.f=n.f||{file:{size:0,data:""},edt:{}};var c,s={tagTab1:!0,tagTab2:!0};if(c=e.dlgDoModal(600,700,a)){var o=apn.CExe.CSS_SETUP_PANE+"height:"+(c.clientHeight-40)+"px";c.tagTab=c.$TAG("div",{style:"position:relative;font-weight:bold;width:100%;height:26px;padding-bottom:14px;"}),c.tagTab.innerHTML='<span id="tagTab1" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스프라이트",en:"Sprite Sheet",ja:"スプライト"})+'</span><span id="tagTab2" style="'+apn.CExe.CSS_SETUP_TAB+'">'+apn.CExe.GL({ko:"스텝 연동",en:"Step Interface",ja:"ステップ連動"})+"</span>"+apn.CExe.CSS_SETUP_TAB_END,c.tagTab.$$("tagTab1").onclick=c.tagTab.$$("tagTab2").onclick=r,c.tagTab1=c.$TAG("div",{style:o}),c.tagTab2=c.$TAG("div",{style:o}),eduLib.edtInputAdd(e,c.tagTab1,{type:"image",title:apn.CExe.GL({ko:"스프라이트 시트 이미지",en:"Sprite sheet image",ja:"スプライトシートの画像"}),value:n.s,key:"img",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"message",value:"※ "+apn.CExe.GL({ko:"과도한 이미지의 사용은 HTML5 컨텐츠의 성능을 크게 저하시킵니다. 그러한 경우, Video로 제작하거나 Scene Animation으로 편집하는 것이 좋습니다.",en:"Excessive image resources will slow down HTML5 contents. In that case, video or Scene Animation is better.",ja:"過度な画像の使用は、HTML5コンテンツのパフォーマンスを大幅に低下させます。その場合、Videoでの製作や、Scene Animationでの編集をお勧めします。"}),join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"space"}),eduLib.edtInputAdd(e,c.tagTab1,{type:"title",title:apn.CExe.GL({ko:"프레임 구성 정보",en:"Frame information",ja:"フレーム構成情報"})}),eduLib.edtInputAdd(e,c.tagTab1,{type:"select",title:apn.CExe.GL({ko:"스프라이트 시트 구성",en:"Sprite sheet type",ja:"スプライトシートの構成"}),value:n,key:"ty",options:[{title:"Simple",value:"s"},{title:"Adobe Animate - JSON",value:"f"}],onchange:i,join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"number",title:apn.CExe.GL({ko:"프레임 시간",en:"Duration",ja:"フレーム時間"})+"[ms] (m)",value:n.s,key:"tm",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 너비",en:"Cell width",ja:"フレームセルの幅"})+"[px] (m)",value:n.s,key:"w",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 높이",en:"Cell height",ja:"フレームセルの高さ"})+"[px](m)",value:n.s,key:"h",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 개수",en:"Cell count",ja:"フレームセル数"})+" (m)",value:n.s,key:"cnt",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"프레임 셀 열의 수",en:"Column count",ja:"フレームセル列の数"}),value:n.s,key:"cols",comment:"("+apn.CExe.GL({ko:"1개 행으로 구성된 경우, 0을 입력",en:"0 if cells are aligned in one line",ja:"1つの行で構成された場合、0を入力"})+")",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"시작 X좌표",en:"Start X",ja:"開始X座標"})+"[px]",value:n.s,key:"x",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"s",type:"number",title:apn.CExe.GL({ko:"시작 Y좌표",en:"Start Y",ja:"開始Y座標"})+"[px]",value:n.s,key:"y",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{id:"f",type:"file",title:apn.CExe.GL({ko:"프레임 구성 정보 파일",en:"Frame information file",ja:"フレーム構成情報ファイル"}),value:n.f,key:"file",join:!0}),eduLib.edtInputAdd(e,c.tagTab1,{type:"space"}),eduLib.edtInputAdd(e,c.tagTab1,{type:"title",title:apn.CExe.GL({ko:"대칭 변환",en:"Mirror transformation",ja:"対称変換"})}),eduLib.edtInputAdd(e,c.tagTab1,{type:"select",title:apn.CExe.GL({ko:"방향",en:"Direction",ja:"方向"}),value:n,key:"mr",options:[{title:apn.CExe.GL({ko:"가로",en:"Horizontal",ja:"横"}),value:1},{title:apn.CExe.GL({ko:"세로",en:"Vertical",ja:"縦"}),value:2},{title:apn.CExe.GL({ko:"가로&세로",en:"Both",ja:"横＆縦"}),value:3},{title:apn.CExe.GL({ko:"안함",en:"None",ja:"無効"}),value:0}],join:!0}),uxWgtImgSprite.edtSetupStep(e,t,c.tagTab2,n),void 0!==uxWgtShtSprite._uiLastSetupTab&&c.tagTab.$$(uxWgtShtSprite._uiLastSetupTab)?c.tagTab.$$(uxWgtShtSprite._uiLastSetupTab).onclick():c.tagTab.$$("tagTab1").onclick(),c.tagTab.$$("tagBlank").style.width=c.clientWidth-c.tagTab.$$("tagBlank").offsetLeft-1+"px"}},xa.edtOnFitToSize=function(e,t,a){if(a.cfg.s&&a.cfg.s.w&&a.cfg.s.h)return{w:a.cfg.s.w,h:a.cfg.s.h}},uxWgtShtSprite=xa;
var xa=apn.inheritWidget(apn.widgets["apn.wgt.image"]);xa.styleMap={title:!0,visibility:!0,mediaID:!0,dragX:!0,dragY:!0,dragInParent:!0,dragContainParent:!0,csr:!0},xa.styles={dragX:!0,dragY:!0},xa.editor={},xa.editor.iconThumb="DB/EDU/imgs/wgts/common/icon_thumb.png",xa.scriptInfo={wgtData:{lineColor:{help:{ko:"#FF0000|rgb(255,0,0)|...\n선의 색상",en:"#FF0000|rgb(255,0,0)|...\nColor of the line",ja:"#FF0000|rgb(255,0,0)|...\n線の色"},value:"Color"},line:{help:{ko:"[{x:Number,y:Number},{x:Number,y:Number}]\n그려진 선의 좌표",en:"[{x:Number,y:Number},{x:Number,y:Number}]\nCoordinate of the drawn line",ja:"[{x:Number,y:Number},{x:Number,y:Number}]\n描かれた線の座標"},value:"[{x:Number,y:Number},{x:Number,y:Number}]",type:"go"},base:{help:{ko:"{x:Number,y:Number}\n선의 시작점 위치. Aspen 좌표계",en:"{x:Number,y:Number}\nCoordinate of line's start point in Aspen coordinate system",ja:"{x:Number,y:Number}\n線の始点の位置。Aspen座標系"},value:"{x:Number,y:Number}"}}},xa.properties=xa.properties||{},xa.properties.attrs=xa.properties.attrs||{},xa.properties.attrs.lineColor="#0000FF",xa.properties.attrs.cfg={images:{handle:{mediaID:void 0},base:{mediaID:void 0}},lineColor:"#0000FF",lineWidth:5,basePos:"",dlVer:2},xa.exeOnForceStyle=function(e,t){t.csr&&"apn.auto"!=t.csr||(t.csr="pointer")},xa.exeOnLoad=function(e,t){function a(a,r){eduWgtDragLine._lineTo(e,t,i.ctx.tagLine,i.ctx.sX,i.ctx.sY,a+parseInt(i.style.width)/2,r+parseInt(i.style.height)/2,n.lineWidth,n.lineColor,s,o)}var i=e.wgtTag(t),n=e.wgtGetProperty(t,"cfg"),s=1/e.getZoomX(),o=1/e.getZoomY();return n.images.handle.mediaID?(i.ctx={},i.ctx.tagLine=i.parentNode.$TAG("div",{style:"position:absolute;z-index:"+i.style.zIndex+";display:"+i.style.display}),e.tagPassPointerEvent(i.ctx.tagLine,!0),i.ctx.sX=parseInt(i.style.left)+parseInt(i.style.width)/2,i.ctx.sY=parseInt(i.style.top)+parseInt(i.style.height)/2,n.images.base.mediaID&&(i.ctx.uTagBase=i.parentNode.$TAG("img",{style:"position:absolute;left:"+i.style.left+";top:"+i.style.top+";width:"+i.style.width+";height:"+i.style.height+";z-index:"+i.style.zIndex+";display:"+i.style.display,alt:""}),2==n.dlVer&&(i.ctx.uTagBase.style.opacity=0,i.ctx.uTagBase.onload=function(){this.style.opacity=1,this.style.width=Math.round((this.naturalWidth||this.width)*s)+"px",this.style.height=Math.round((this.naturalHeight||this.height)*s)+"px",this.style.left=i.ctx.sX+Math.floor(e.screen.objects[t].init.cx*s)-parseInt(this.style.width)/2+"px",this.style.top=i.ctx.sY+Math.floor(e.screen.objects[t].init.cy*o)-parseInt(this.style.height)/2+"px"}),i.ctx.uTagBase.src=e.mediaURL(n.images.base.mediaID),e.tagPassPointerEvent(i.ctx.uTagBase,!0)),i.ctx.uTagBase?(e.tagPutUnder(i.ctx.uTagBase,i),"U"==n.basePos?e.tagPutOn(i.ctx.tagLine,i.ctx.uTagBase):e.tagPutUnder(i.ctx.tagLine,i.ctx.uTagBase)):e.tagPutUnder(i.ctx.tagLine,i),i.apxOnDrag=function(e,t,i){return a(t,i),!0},void(i.tagOnPostResize=i.tagOnPostMove=function(e,t){a(parseInt(t.style.left),parseInt(t.style.top))})):void e.log(t,'Image for "Handle" is not set.')},xa.exeOnShow=function(e,t,a){var i=e.wgtTag(t);i.ctx&&(a?(i.ctx.tagLine.style.display="block",i.ctx.uTagBase&&(i.ctx.uTagBase.style.display="block")):(i.ctx.tagLine.style.display="none",i.ctx.uTagBase&&(i.ctx.uTagBase.style.display="none")))},xa._lineTo=function(e,t,a,i,n,s,o,r,l,g,d){function p(e,t,a,i){return Math.atan2(a-e,t-i)%(2*Math.PI)*(180/Math.PI)-90}var x=r*Math.min(g,d),c=0,u=0;"1px"==a.style.height&&(c=1);var y=e.wgtGetProperty(t,"cfg");2==y.dlVer&&(u+=Math.floor(e.screen.objects[t].init.cx*g),c+=Math.floor(e.screen.objects[t].init.cy*d));var h=Math.sqrt(Math.pow(s-i,2)+Math.pow(o-n,2))+.5;a.style.top=n-Math.floor(x/2)+c+"px",a.style.width=h+Math.floor(x)+"px",a.style.left=i-Math.floor(x/2)+u+"px",apn.CES.transformSet(a,"origin",Math.floor(x/2)+"px 50%"),a.$CSS("borderRadius",Math.floor(x)+"px"),apn.CES.transformSet(a,"rotate",p(i,n,s,o)),apn.CES.transformApply(a);var m="solid";if(a.style.borderTop=m+" "+(0==x?0:Math.floor(x)||1)+"px "+l,2==y.dlVer){var b=e.wgtTag(t);b.ctx.uTagBase&&(b.ctx.uTagBase.style.left=i+u-parseInt(b.ctx.uTagBase.style.width)/2+"px",b.ctx.uTagBase.style.top=n+c-parseInt(b.ctx.uTagBase.style.height)/2+"px")}},xa.exePropGet=function(e,t,a,i){if("base"==a){if(i)return!0;var n=e.wgtTag(t);if(n.ctx)return{x:e.toCanvasX(n.ctx.sX),y:e.toCanvasY(n.ctx.sY)}}else if("line"==a){if(i)return!0;var n=e.wgtTag(t);if(n.ctx){var s=bx.HCL.getElementX2(n.parentNode)-bx.HCL.getElementX2(e.tag),o=bx.HCL.getElementY2(n.parentNode)-bx.HCL.getElementY2(e.tag);return[{x:Math.round(e.toCanvasX(n.ctx.sX+s)+e.screen.objects[t].init.cx),y:Math.round(e.toCanvasY(n.ctx.sY+o)+e.screen.objects[t].init.cy)},{x:Math.round(e.toCanvasX(parseInt(n.style.left)+s)+e.wgtW(t)/2+e.screen.objects[t].init.cx),y:Math.round(e.toCanvasY(parseInt(n.style.top)+o)+e.wgtH(t)/2+e.screen.objects[t].init.cy)}]}}else if("lineColor"==a){if(i)return!0;var r=e.wgtGetProperty(t,"cfg");return r.lineColor}},xa.exePropSet=function(e,t,a,i,n){if("base"==a){if(n)return!0;i&&i instanceof Object&&void 0!==i.x&&void 0!==i.y?(i.x-=e.screen.objects[t].init.cx,i.y-=e.screen.objects[t].init.cy):i={x:e.wgtX(t)+e.wgtW(t)/2,y:e.wgtY(t)+e.wgtH(t)/2};var s=e.wgtTag(t);if(s.ctx){s.ctx.sX=apn.widgets.utils.toScreenX(e,s,i.x,1/e.getZoomX()),s.ctx.sY=apn.widgets.utils.toScreenY(e,s,i.y,1/e.getZoomY());var o=e.wgtGetProperty(t,"cfg");this._lineTo(e,t,s.ctx.tagLine,s.ctx.sX,s.ctx.sY,parseInt(s.style.left)+parseInt(s.style.width)/2,parseInt(s.style.top)+parseInt(s.style.height)/2,o.lineWidth,o.lineColor,1/e.getZoomX(),1/e.getZoomY())}}else if("lineColor"==a){if(n)return!0;if(i){var s=e.wgtTag(t);if(s.ctx){var o=e.wgtGetProperty(t,"cfg");o.lineColor=i,s.ctx.tagLine&&(s.ctx.tagLine.style.borderColor=i)}}else e.log(t,"Widget:setData('lineColor') - Invalid parameter.")}},xa.edtOnPreDraw=function(e,t,a,i,n,s,o,r){function l(t,a,i){a&&(d._wgtImgBase=p.base.image,e.invalidateRect(d),e.draw())}var g=e.wgtGetProperty(t,"cfg");if(g&&2==g.dlVer&&g.images.base.mediaID){var d=e.getObjectByID(t);if(void 0===d._wgtImgBase){d._wgtImgBase=null;var p={};p.base={url:e.mediaURL(g.images.base.mediaID)},(new apn.CRscLoader).load(e.getData(),p,l)}else if(d._wgtImgBase){var x=d.shape.w/2-d._wgtImgBase.width/2,c=d.shape.h/2-d._wgtImgBase.height/2;d.rotation&&(x+=d.rotation.cx,c+=d.rotation.cy),a.drawImage(d._wgtImgBase,i+x,n+c,d._wgtImgBase.width,d._wgtImgBase.height)}}},xa.onEdit=void 0,xa.edtOnConfig=function(e,t){function a(){eduLib.edtInputApplyAll(e,i),n.lineWidth=parseInt(n.lineWidth),(n.images.handle.mediaID||n.images.base.mediaID)&&e.wgtSetProperty(t,"apxMediaID",n.images.handle.mediaID||n.images.base.mediaID),e.wgtSetProperty(t,"lineColor",n.lineColor),e.wgtSetProperty(t,"cfg",n),e.getObjectByID(t)._wgtImgBase=void 0}var i,n=e.wgtGetProperty(t,"cfg");(i=e.dlgDoModal(600,500,a))&&(eduLib.edtInputAdd(e,i,{type:"title",title:apn.CExe.GL({ko:"이미지",en:"Image",ja:"画像"})}),eduLib.edtInputAdd(e,i,{type:"image",title:apn.CExe.GL({ko:"핸들",en:"Handle",ja:"ハンドル"})+" (m)",value:n.images,key:"handle",join:!0}),eduLib.edtInputAdd(e,i,{type:"image",title:apn.CExe.GL({ko:"베이스",en:"Base",ja:"ベース"}),value:n.images,key:"base",join:!0}),eduLib.edtInputAdd(e,i,{type:"select",title:apn.CExe.GL({ko:"베이스 - 위치",en:"Base - Position",ja:"ベース - 位置"}),options:[{title:apn.CExe.GL({ko:"선 아래",en:"Under the line",ja:"線の下"}),value:"U"},{title:apn.CExe.GL({ko:"[선 위]",en:"[On the line]",ja:"[線の上]"}),value:""}],value:n,key:"basePos",join:!0}),eduLib.edtInputAdd(e,i,{type:"space"}),eduLib.edtInputAdd(e,i,{type:"title",title:apn.CExe.GL({ko:"선",en:"Line",ja:"線"})}),eduLib.edtInputAdd(e,i,{type:"select",title:apn.CExe.GL({ko:"굵기",en:"Weight",ja:"太さ"}),options:["1","2","3","4","5","7","9","11","13","15","19"],value:n,key:"lineWidth",join:!0}),eduLib.edtInputAdd(e,i,{type:"color",title:apn.CExe.GL({ko:"색상",en:"Color",ja:"色"}),value:n,key:"lineColor",join:!0}))},eduWgtDragLine=xa;
